<!DOCTYPE html>

<html lang="en" data-content_root="../../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>cromosim.domain &#8212; cromosim  documentation</title>
    
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../../_static/scrolls.css?v=4cde0d18" />
    <link rel="stylesheet" href="_static/print.css" type="text/css" />
    
    <script src="../../_static/documentation_options.js?v=5929fcd5"></script>
    <script src="../../_static/doctools.js?v=9bcbadda"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/theme_extras.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
  </head><body>
    <div id="content">
      <div class="header">
        <h1 class="heading"><a href="../../index.html"
          title="back to the documentation overview"><span>cromosim.domain</span></a></h1>
      </div>
      <div class="relnav" role="navigation" aria-label="Related">
        <a href="#">cromosim.domain</a>
      </div>
      <div id="contentwrapper">
        <div role="main">
        
  <h1>Source code for cromosim.domain</h1><div class="highlight"><pre>
<span></span><span class="c1"># Authors:</span>
<span class="c1">#     Sylvain Faure &lt;sylvain.faure@universite-paris-saclay.fr&gt;</span>
<span class="c1">#     Bertrand Maury &lt;bertrand.maury@universite-paris-saclay.fr&gt;</span>
<span class="c1"># License: GPL</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">scipy</span> <span class="k">as</span> <span class="nn">sp</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="kn">from</span> <span class="nn">matplotlib.patches</span> <span class="kn">import</span> <span class="n">Ellipse</span><span class="p">,</span> <span class="n">Circle</span><span class="p">,</span> <span class="n">Rectangle</span><span class="p">,</span> <span class="n">Polygon</span>
<span class="kn">from</span> <span class="nn">matplotlib.lines</span> <span class="kn">import</span> <span class="n">Line2D</span>
<span class="kn">from</span> <span class="nn">PIL</span> <span class="kn">import</span> <span class="n">Image</span>
<span class="kn">from</span> <span class="nn">PIL</span> <span class="kn">import</span> <span class="n">ImageDraw</span>
<span class="kn">import</span> <span class="nn">skfmm</span>


<div class="viewcode-block" id="Destination">
<a class="viewcode-back" href="../../domain.html#cromosim.domain.Destination">[docs]</a>
<span class="k">class</span> <span class="nc">Destination</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A Destination object contains all the information necessary to direct</span>
<span class="sd">    people to a goal, for example a door, a staircase or another floor.</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>

<span class="sd">    name: string</span>
<span class="sd">       name of the destination</span>
<span class="sd">    colors: list</span>
<span class="sd">       List of colors ``[ [r,g,b],... ]`` drawing the destination.</span>
<span class="sd">       For example, a door can be represented by a red line.</span>
<span class="sd">    excluded_colors: list</span>
<span class="sd">        List of colors ``[ [r,g,b],... ]`` representing obstacles that cannot be crossed for</span>
<span class="sd">        someone wishing to go to this destination: the walls of course, but</span>
<span class="sd">        possibly another objects only visible to the people concerned by</span>
<span class="sd">        this destination.</span>
<span class="sd">    desired_velocity_from_color: list</span>
<span class="sd">        Allows you to associate a desired velocity (vx, vy) with a</span>
<span class="sd">        color (r, g, b):</span>
<span class="sd">            ``[ [r,g,b, vx,vy],... ]``.</span>
<span class="sd">    fmm_speed: numpy array</span>
<span class="sd">        To automatically calculate the desired velocity leading to this</span>
<span class="sd">        destination, a Fast-Marching method is used to calculate the travel</span>
<span class="sd">        time to this destination. The opposite of the gradient of this time</span>
<span class="sd">        gives the desired velocity. This method solves the Eikonal equation</span>
<span class="sd">        ``|grad D| = 1/fmm_speed``. By changing the ``fmm_speed`` (1 everywhere by</span>
<span class="sd">        default) you can make certain areas slower and thus modify the</span>
<span class="sd">        desired velocity to divert people</span>
<span class="sd">    velocity_scale: float</span>
<span class="sd">        Multiplying coefficient used in front of the desired velocity vector</span>
<span class="sd">        (which is renormalized). For example on a staircase one may wish to</span>
<span class="sd">        reduce the speed of people.</span>
<span class="sd">    next_destination: string</span>
<span class="sd">        Name of the next destination. Useful for linking destinations one</span>
<span class="sd">        after the other</span>
<span class="sd">    next_domain: string</span>
<span class="sd">        Name of the next domain where is the next_destination</span>
<span class="sd">    next_transit_box: list</span>
<span class="sd">        The people in the current domain present in this box will be duplicated</span>
<span class="sd">        in the next_domain. A box is defined by four points:</span>
<span class="sd">            ``[x0, y0, x1, y1, x2, y2, x3, y3]``</span>
<span class="sd">    distance: numpy array</span>
<span class="sd">        Distance (if ``fmm_speed`` == 1) or travel time (if ``fmm_speed`` != 1)</span>
<span class="sd">        to the destination</span>
<span class="sd">    desired_velocity_X: numpy array</span>
<span class="sd">        First component of the desired velocity</span>
<span class="sd">    desired_velocity_Y: numpy array</span>
<span class="sd">        Second component of the desired velocity</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>

<span class="sd">     * Examples with one destination:</span>
<span class="sd">        ``cromosim/examples/domain/domain_room.py``</span>
<span class="sd">        ``cromosim/examples/domain/domain_stadium.py``</span>
<span class="sd">     * Example with several destinations:</span>
<span class="sd">        ``cromosim/examples/domain/domain_shibuya_crossing.py``</span>
<span class="sd">     * Example with a destination described in a json file</span>
<span class="sd">        ``cromosim/examples/domain/domain_from_json.py``</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                 <span class="n">name</span><span class="p">,</span>
                 <span class="n">colors</span><span class="p">,</span>
                 <span class="n">excluded_colors</span><span class="o">=</span><span class="p">[],</span>
                 <span class="n">desired_velocity_from_color</span><span class="o">=</span><span class="p">[],</span>
                 <span class="n">fmm_speed</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">velocity_scale</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                 <span class="n">next_destination</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">next_domain</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">next_transit_box</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Constructor of a Destination object</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        name: string</span>
<span class="sd">           name of the destination</span>
<span class="sd">        colors: list ``[ [r,g,b],... ]``</span>
<span class="sd">           List of colors drawing the destination. For example, a door can be</span>
<span class="sd">           represented by a red line.</span>
<span class="sd">        excluded_colors: = list ``[ [r,g,b],... ]``</span>
<span class="sd">            List of colors representing obstacles that cannot be crossed for</span>
<span class="sd">            someone wishing to go to this destination: the walls of course, but</span>
<span class="sd">            possibly another objects only visible to the people concerned by</span>
<span class="sd">            this destination.</span>
<span class="sd">        desired_velocity_from_color: list ``[ [r,g,b, vx,vy],... ]``</span>
<span class="sd">            Allows you to associate a desired velocity (vx, vy) with a</span>
<span class="sd">            color (r, g, b)</span>
<span class="sd">        fmm_speed:= numpy array</span>
<span class="sd">            To automatically calculate the desired velocity leading to this</span>
<span class="sd">            destination, a Fast-Marching method is used to calculate the travel</span>
<span class="sd">            time to this destination. The opposite of the gradient of this time</span>
<span class="sd">            gives the desired velocity. This method solves the Eikonal equation</span>
<span class="sd">            |grad D| = 1/fmm_speed. By changing the fmm_speed (1 everywhere by</span>
<span class="sd">            default) you can make certain areas slower and thus modify the</span>
<span class="sd">            desired velocity to divert people</span>
<span class="sd">        velocity_scale: float</span>
<span class="sd">            Multiplying coefficient used in front of the desired velocity vector</span>
<span class="sd">            (which is renormalized). For example on a staircase one may wish to</span>
<span class="sd">            reduce the speed of people.</span>
<span class="sd">        next_destination: string</span>
<span class="sd">            Name of the next destination. Useful for linking destinations one</span>
<span class="sd">            after the other</span>
<span class="sd">        next_domain:</span>
<span class="sd">            Name of the next domain where is the next_destination</span>
<span class="sd">        next_transit_box:</span>
<span class="sd">            The people in the current domain present in this box will be duplicated</span>
<span class="sd">            in the ``next_domain``.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">colors</span> <span class="o">=</span> <span class="n">colors</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">excluded_colors</span> <span class="o">=</span> <span class="n">excluded_colors</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">desired_velocity_from_color</span> <span class="o">=</span> <span class="n">desired_velocity_from_color</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fmm_speed</span> <span class="o">=</span> <span class="n">fmm_speed</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">velocity_scale</span> <span class="o">=</span> <span class="n">velocity_scale</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">next_destination</span> <span class="o">=</span> <span class="n">next_destination</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">next_transit_box</span> <span class="o">=</span> <span class="n">next_transit_box</span>  <span class="c1"># [xmin,xmax,ymin,ymax]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">next_domain</span> <span class="o">=</span> <span class="n">next_domain</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">distance</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">desired_velocity_X</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">desired_velocity_Y</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Print this Destination object</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="s2">&quot;--&gt; Destination: &quot;</span> \
            <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">    name: &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span> \
            <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">    colors: &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">colors</span><span class="p">)</span> \
            <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">    excluded_colors: &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">excluded_colors</span><span class="p">)</span> \
            <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">    desired_velocity_from_color: &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">desired_velocity_from_color</span><span class="p">)</span> \
            <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">    next_destination: &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">next_destination</span><span class="p">)</span> \
            <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">    next_domain: &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">next_domain</span><span class="p">)</span> \
            <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">    velocity_scale: &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">velocity_scale</span><span class="p">)</span></div>



<div class="viewcode-block" id="Domain">
<a class="viewcode-back" href="../../domain.html#cromosim.domain.Domain">[docs]</a>
<span class="k">class</span> <span class="nc">Domain</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    To define the computational domain:</span>
<span class="sd">     * a background: empty (white) or a PNG image which only</span>
<span class="sd">       contains the colors white, red (for the doors) and black</span>
<span class="sd">       (for the walls)</span>
<span class="sd">     * supplementary doors represented by matplotlib shapes:</span>
<span class="sd">        ``line2D``</span>
<span class="sd">     * supplementary walls represented by matplotlib shapes:</span>
<span class="sd">        ``line2D``, ``circle``, ``ellipse``, ``rectangle`` or ``polygon``</span>

<span class="sd">    To compute the obstacle distances and the desired velocities</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>

<span class="sd">    pixel_size: float</span>
<span class="sd">        size of a pixel in meters</span>
<span class="sd">    width: int</span>
<span class="sd">        width of the background image (number of pixels)</span>
<span class="sd">    height: int</span>
<span class="sd">        height of the background image (number of pixels)</span>
<span class="sd">    xmin: float</span>
<span class="sd">        x coordinate of the origin (bottom left corner)</span>
<span class="sd">    xmax: float</span>
<span class="sd">        ``xmax = xmin + width*pixel_size``</span>
<span class="sd">    ymin: float</span>
<span class="sd">        y coordinate of the origin (bottom left corner)</span>
<span class="sd">    ymax: float</span>
<span class="sd">        ``ymax = ymin + height*pixel_size``</span>
<span class="sd">    X: numpy array</span>
<span class="sd">        x coordinates (meshgrid)</span>
<span class="sd">    Y: numpy array</span>
<span class="sd">        y coordinates (meshgrid)</span>
<span class="sd">    image: numpy array</span>
<span class="sd">        pixel array (r,g,b,a)</span>
<span class="sd">        The Pillow image is converted to a numpy arrays, then</span>
<span class="sd">        using ``flipud``</span>
<span class="sd">        the origin of the image is put it down left instead the</span>
<span class="sd">        top left</span>
<span class="sd">    image_red: numpy array</span>
<span class="sd">        red values of the image (r,g,b,a)</span>
<span class="sd">    image_green: numpy array</span>
<span class="sd">        green values of the image (r,g,b,a)</span>
<span class="sd">    image_blue: numpy array</span>
<span class="sd">        blue values of the image (r,g,b,a)</span>
<span class="sd">    wall_mask: numpy array</span>
<span class="sd">        boolean array: true for wall pixels</span>
<span class="sd">    wall_mask_id: numpy array</span>
<span class="sd">        wall pixel indices</span>
<span class="sd">    wall_distance: numpy array</span>
<span class="sd">        distance (m) to the wall</span>
<span class="sd">    wall_grad_X: numpy array</span>
<span class="sd">        gradient of the distance to the wall (first component)</span>
<span class="sd">    wall_grad_Y: numpy array</span>
<span class="sd">        gradient of the distance to the wall (second component)</span>
<span class="sd">    door_distance: numpy array</span>
<span class="sd">        distance (m) to the door</span>
<span class="sd">    desired_velocity_X: numpy array</span>
<span class="sd">        opposite of the gradient of the distance to the door: desired velocity</span>
<span class="sd">         (first component)</span>
<span class="sd">    desired_velocity_Y: numpy array</span>
<span class="sd">        opposite of the gradient of the distance to the door: desired velocity</span>
<span class="sd">        (second component)</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>

<span class="sd">    * A simple room</span>
<span class="sd">        ``cromosim/examples/domain/domain_room.py``</span>
<span class="sd">    * A circular domain</span>
<span class="sd">        ``cromosim/examples/domain/domain_stadium.py``</span>
<span class="sd">    * A domain with several destinations</span>
<span class="sd">        ``cromosim/examples/domain/domain_shibuya_crossing.py``</span>
<span class="sd">    * A domain built from json file (where is its description)</span>
<span class="sd">        ``cromosim/examples/domain/domain_from_json.py``</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;Domain&#39;</span><span class="p">,</span> <span class="n">background</span><span class="o">=</span><span class="s1">&#39;White&#39;</span><span class="p">,</span> <span class="n">pixel_size</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>
                 <span class="n">xmin</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
                 <span class="n">ymin</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
                 <span class="n">wall_colors</span><span class="o">=</span><span class="p">[[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]],</span>
                 <span class="n">npzfile</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Constructor of a Domain object</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        name: string</span>
<span class="sd">            domain name (default: &#39;Domain&#39;)</span>
<span class="sd">        background: string</span>
<span class="sd">            name of the background image (default: &#39;White&#39;, no image)</span>
<span class="sd">        pixel_size: float</span>
<span class="sd">            size of a pixel in meters (default: 1.0)</span>
<span class="sd">        xmin: float</span>
<span class="sd">            x coordinate of the origin, bottom left corner (default: 0.0)</span>
<span class="sd">        ymin: float</span>
<span class="sd">            y coordinate of the origin, bottom left corner (default: 0.0)</span>
<span class="sd">        width: int</span>
<span class="sd">            width of the background image (default: 100 pixels)</span>
<span class="sd">        height: int</span>
<span class="sd">            height of the background image (default: 100 pixels)</span>
<span class="sd">        npzfile: string</span>
<span class="sd">            to build domain from a npz file which contains all variables</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">npzfile</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__shapes</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__outline_color_shapes</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__fill_color_shapes</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__image_filename</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__background</span> <span class="o">=</span> <span class="n">background</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">destinations</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pixel_size</span> <span class="o">=</span> <span class="n">pixel_size</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">xmin</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ymin</span> <span class="o">=</span> <span class="p">[</span><span class="n">xmin</span><span class="p">,</span> <span class="n">ymin</span><span class="p">]</span>
            <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__background</span> <span class="o">!=</span> <span class="s1">&#39;White&#39;</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">image</span> <span class="o">=</span> <span class="n">Image</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__background</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">width</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">size</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">height</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">size</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">width</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">height</span> <span class="o">=</span> <span class="p">[</span><span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">image</span> <span class="o">=</span> <span class="n">Image</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="s2">&quot;RGB&quot;</span><span class="p">,</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">width</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">height</span><span class="p">),</span> <span class="s2">&quot;white&quot;</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">xmax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">xmin</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">width</span><span class="o">*</span><span class="n">pixel_size</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ymax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ymin</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">height</span><span class="o">*</span><span class="n">pixel_size</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">X</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">width</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">height</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">X</span> <span class="o">=</span> <span class="mf">0.5</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">pixel_size</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">xmin</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">X</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">pixel_size</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Y</span> <span class="o">=</span> <span class="mf">0.5</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">pixel_size</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">ymin</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">Y</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">pixel_size</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">wall_colors</span> <span class="o">=</span> <span class="n">wall_colors</span>  <span class="c1"># walls are black by default</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">wall_mask</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">wall_id</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">wall_distance</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">wall_grad_X</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">wall_grad_Y</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">draw</span> <span class="o">=</span> <span class="n">ImageDraw</span><span class="o">.</span><span class="n">Draw</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">image</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">npzfile</span><span class="p">,</span> <span class="n">allow_pickle</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__shapes</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;__shapes&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__outline_color_shapes</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;__outline_color_shapes&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__fill_color_shapes</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;__fill_color_shapes&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__image_filename</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;__image_filename&quot;</span><span class="p">]</span>
            <span class="c1"># print(&quot;read name: &quot;,data[&quot;name&quot;])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">])</span>
            <span class="c1"># print(&quot;read __background: &quot;,data[&quot;__background&quot;])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__background</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;__background&quot;</span><span class="p">])</span>
            <span class="c1"># print(&quot;read destinations: &quot;,data[&quot;destinations&quot;])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">destinations</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;destinations&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>
            <span class="c1"># print(&quot;read pixel_size: &quot;,data[&quot;pixel_size&quot;])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pixel_size</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;pixel_size&quot;</span><span class="p">]</span>
            <span class="c1"># print(&quot;read xmin: &quot;,data[&quot;xmin&quot;])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">xmin</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;xmin&quot;</span><span class="p">]</span>
            <span class="c1"># print(&quot;read ymin: &quot;,data[&quot;ymin&quot;])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ymin</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;ymin&quot;</span><span class="p">]</span>
            <span class="c1"># print(&quot;read xmax: &quot;,data[&quot;xmax&quot;])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">xmax</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;xmax&quot;</span><span class="p">]</span>
            <span class="c1"># print(&quot;read ymax: &quot;,data[&quot;ymax&quot;])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ymax</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;ymax&quot;</span><span class="p">]</span>
            <span class="c1"># print(&quot;read width: &quot;,data[&quot;width&quot;])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">width</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;width&quot;</span><span class="p">]</span>
            <span class="c1"># print(&quot;read height: &quot;,data[&quot;height&quot;])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">height</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;height&quot;</span><span class="p">]</span>
            <span class="c1"># print(&quot;read X: &quot;,data[&quot;X&quot;])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">X</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;X&quot;</span><span class="p">]</span>
            <span class="c1"># print(&quot;read Y: &quot;,data[&quot;Y&quot;])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Y</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;Y&quot;</span><span class="p">]</span>
            <span class="c1"># print(&quot;read wall_colors: &quot;,data[&quot;wall_colors&quot;])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">wall_colors</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;wall_colors&quot;</span><span class="p">]</span>
            <span class="c1"># print(&quot;read wall_mask: &quot;,data[&quot;wall_mask&quot;])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">wall_mask</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;wall_mask&quot;</span><span class="p">]</span>
            <span class="c1"># print(&quot;read wall_id: &quot;,data[&quot;wall_id&quot;])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">wall_id</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;wall_id&quot;</span><span class="p">]</span>
            <span class="c1"># print(&quot;read wall_distance: &quot;,data[&quot;wall_distance&quot;])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">wall_distance</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;wall_distance&quot;</span><span class="p">]</span>
            <span class="c1"># print(&quot;read wall_grad_X: &quot;,data[&quot;wall_grad_X&quot;])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">wall_grad_X</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;wall_grad_X&quot;</span><span class="p">]</span>
            <span class="c1"># print(&quot;read wall_grad_Y: &quot;,data[&quot;wall_grad_Y&quot;])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">wall_grad_Y</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;wall_grad_Y&quot;</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">image</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;image&quot;</span><span class="p">]</span>

<div class="viewcode-block" id="Domain.save">
<a class="viewcode-back" href="../../domain.html#cromosim.domain.Domain.save">[docs]</a>
    <span class="k">def</span> <span class="nf">save</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">outfile</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;To save the content of the domain in a file</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        outfile: string</span>
<span class="sd">            output filename</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">np</span><span class="o">.</span><span class="n">savez</span><span class="p">(</span>
            <span class="n">outfile</span><span class="p">,</span>
            <span class="n">__shapes</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">__shapes</span><span class="p">,</span>
            <span class="n">__outline_color_shapes</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">__outline_color_shapes</span><span class="p">,</span>
            <span class="n">__fill_color_shapes</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">__fill_color_shapes</span><span class="p">,</span>
            <span class="n">__image_filename</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">__image_filename</span><span class="p">,</span>
            <span class="n">name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
            <span class="n">__background</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">__background</span><span class="p">,</span>
            <span class="n">pixel_size</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">pixel_size</span><span class="p">,</span>
            <span class="n">xmin</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">xmin</span><span class="p">,</span>
            <span class="n">ymin</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ymin</span><span class="p">,</span>
            <span class="n">xmax</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">xmax</span><span class="p">,</span>
            <span class="n">ymax</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ymax</span><span class="p">,</span>
            <span class="n">width</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">width</span><span class="p">,</span>
            <span class="n">height</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">height</span><span class="p">,</span>
            <span class="n">X</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">X</span><span class="p">,</span>
            <span class="n">Y</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">Y</span><span class="p">,</span>
            <span class="n">wall_colors</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">wall_colors</span><span class="p">,</span>
            <span class="n">wall_mask</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">wall_mask</span><span class="p">,</span>
            <span class="n">wall_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">wall_id</span><span class="p">,</span>
            <span class="n">wall_distance</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">wall_distance</span><span class="p">,</span>
            <span class="n">wall_grad_X</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">wall_grad_X</span><span class="p">,</span>
            <span class="n">wall_grad_Y</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">wall_grad_Y</span><span class="p">,</span>
            <span class="n">destinations</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">destinations</span><span class="p">,</span>
            <span class="n">image</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">image</span><span class="p">)</span></div>


<div class="viewcode-block" id="Domain.add_shape">
<a class="viewcode-back" href="../../domain.html#cromosim.domain.Domain.add_shape">[docs]</a>
    <span class="k">def</span> <span class="nf">add_shape</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">shape</span><span class="p">,</span> <span class="n">outline_color</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">fill_color</span><span class="o">=</span><span class="p">[</span><span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">]):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;To add a matplotlib shape:</span>
<span class="sd">        ``line2D``, ``circle``, ``ellipse``, ``rectangle`` or ``polygon``</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        shape: matplotlib shape</span>
<span class="sd">            line2D, circle, ellipse, rectangle or polygon</span>
<span class="sd">        outline_color: list</span>
<span class="sd">            rgb color</span>
<span class="sd">        fill_color: list</span>
<span class="sd">            rgb color</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__shapes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">shape</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__outline_color_shapes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">outline_color</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__fill_color_shapes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fill_color</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">shape</span><span class="p">,</span> <span class="n">Circle</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">shape</span><span class="p">,</span> <span class="n">Ellipse</span><span class="p">)</span> <span class="ow">or</span>
                <span class="nb">isinstance</span><span class="p">(</span><span class="n">shape</span><span class="p">,</span> <span class="n">Rectangle</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">shape</span><span class="p">,</span> <span class="n">Polygon</span><span class="p">)):</span>
            <span class="n">xy</span> <span class="o">=</span> <span class="n">shape</span><span class="o">.</span><span class="n">get_verts</span><span class="p">()</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">pixel_size</span>
            <span class="n">xy</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">height</span> <span class="o">-</span> <span class="n">xy</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">draw</span><span class="o">.</span><span class="n">polygon</span><span class="p">(</span>
                <span class="n">np</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">xy</span><span class="o">.</span><span class="n">flatten</span><span class="p">())</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span>
                <span class="n">outline</span><span class="o">=</span><span class="s2">&quot;rgb(&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">outline_color</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">+</span><span class="s2">&quot;,&quot;</span> <span class="o">+</span>
                <span class="nb">str</span><span class="p">(</span><span class="n">outline_color</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">+</span><span class="s2">&quot;,&quot;</span> <span class="o">+</span>
                <span class="nb">str</span><span class="p">(</span><span class="n">outline_color</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span><span class="o">+</span><span class="s2">&quot;)&quot;</span><span class="p">,</span>
                <span class="n">fill</span><span class="o">=</span><span class="s2">&quot;rgb(&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">fill_color</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">+</span><span class="s2">&quot;,&quot;</span> <span class="o">+</span>
                <span class="nb">str</span><span class="p">(</span><span class="n">fill_color</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">+</span><span class="s2">&quot;,&quot;</span> <span class="o">+</span>
                <span class="nb">str</span><span class="p">(</span><span class="n">fill_color</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span><span class="o">+</span><span class="s2">&quot;)&quot;</span><span class="p">)</span>
            <span class="n">linewidth</span> <span class="o">=</span> <span class="n">shape</span><span class="o">.</span><span class="n">get_linewidth</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">draw</span><span class="o">.</span><span class="n">line</span><span class="p">(</span>
                <span class="n">np</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">xy</span><span class="o">.</span><span class="n">flatten</span><span class="p">())</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span>
                <span class="n">width</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">linewidth</span><span class="p">),</span>
                <span class="n">fill</span><span class="o">=</span><span class="s2">&quot;rgb(&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">outline_color</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">+</span><span class="s2">&quot;,&quot;</span> <span class="o">+</span>
                <span class="nb">str</span><span class="p">(</span><span class="n">outline_color</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">+</span><span class="s2">&quot;,&quot;</span> <span class="o">+</span>
                <span class="nb">str</span><span class="p">(</span><span class="n">outline_color</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span><span class="o">+</span><span class="s2">&quot;)&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">shape</span><span class="p">,</span> <span class="n">Line2D</span><span class="p">):</span>
            <span class="n">linewidth</span> <span class="o">=</span> <span class="n">shape</span><span class="o">.</span><span class="n">get_linewidth</span><span class="p">()</span>
            <span class="n">xy</span> <span class="o">=</span> <span class="n">shape</span><span class="o">.</span><span class="n">get_xydata</span><span class="p">()</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">pixel_size</span>
            <span class="n">xy</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">height</span> <span class="o">-</span> <span class="n">xy</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">draw</span><span class="o">.</span><span class="n">line</span><span class="p">(</span>
                <span class="n">np</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">xy</span><span class="o">.</span><span class="n">flatten</span><span class="p">())</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span>
                <span class="n">width</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">linewidth</span><span class="p">),</span>
                <span class="n">fill</span><span class="o">=</span><span class="s2">&quot;rgb(&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">outline_color</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">+</span><span class="s2">&quot;,&quot;</span> <span class="o">+</span>
                <span class="nb">str</span><span class="p">(</span><span class="n">outline_color</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">+</span><span class="s2">&quot;,&quot;</span> <span class="o">+</span>
                <span class="nb">str</span><span class="p">(</span><span class="n">outline_color</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span><span class="o">+</span><span class="s2">&quot;)&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="Domain.build_domain">
<a class="viewcode-back" href="../../domain.html#cromosim.domain.Domain.build_domain">[docs]</a>
    <span class="k">def</span> <span class="nf">build_domain</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;To build the domain: reads the background image (if supplied) \</span>
<span class="sd">        and initializes all the color arrrays</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__image_filename</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="o">+</span><span class="s1">&#39;_domain.png&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__image_filename</span><span class="p">)</span>
        <span class="c1"># Easy way to convert a Pillow image to numpy arrays...</span>
        <span class="c1"># The origin of img is at the top (left) and flipud allows to put it down...</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">image</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">flipud</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">image</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">image_red</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">image</span><span class="p">[:,</span> <span class="p">:,</span> <span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">image_green</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">image</span><span class="p">[:,</span> <span class="p">:,</span> <span class="mi">1</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">image_blue</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">image</span><span class="p">[:,</span> <span class="p">:,</span> <span class="mi">2</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wall_mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">image_red</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">wall_colors</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">wall_mask</span> <span class="o">+=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">image_red</span> <span class="o">==</span> <span class="n">c</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> \
                <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">image_green</span> <span class="o">==</span> <span class="n">c</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> \
                <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">image_blue</span> <span class="o">==</span> <span class="n">c</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wall_id</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">wall_mask</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
        <span class="c1"># Compute wall distances: wall = &quot;wall_colors&quot; pixels</span>
        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">wall_id</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">size</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">compute_wall_distance</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;WARNING: Failed to compute wall distance!&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;WARNING: Wall colors are &quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">wall_colors</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;WARNING: Check that there are pixels with these colors!&quot;</span><span class="p">)</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">()</span></div>


<div class="viewcode-block" id="Domain.compute_wall_distance">
<a class="viewcode-back" href="../../domain.html#cromosim.domain.Domain.compute_wall_distance">[docs]</a>
    <span class="k">def</span> <span class="nf">compute_wall_distance</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;To compute the geodesic distance to the walls in using</span>
<span class="sd">        a fast-marching method</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">phi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">image_red</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">wall_id</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span>
            <span class="n">phi</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">wall_id</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">wall_distance</span> <span class="o">=</span> <span class="n">skfmm</span><span class="o">.</span><span class="n">distance</span><span class="p">(</span><span class="n">phi</span><span class="p">,</span> <span class="n">dx</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">pixel_size</span><span class="p">)</span>
            <span class="n">grad</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">gradient</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">wall_distance</span><span class="p">,</span> <span class="n">edge_order</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
            <span class="n">grad_X</span> <span class="o">=</span> <span class="n">grad</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">pixel_size</span>
            <span class="n">grad_Y</span> <span class="o">=</span> <span class="n">grad</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">pixel_size</span>
            <span class="n">norm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">grad_X</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">grad_Y</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
            <span class="n">norm</span> <span class="o">=</span> <span class="p">(</span><span class="n">norm</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">*</span> <span class="n">norm</span> <span class="o">+</span> <span class="p">(</span><span class="n">norm</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.001</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">wall_grad_X</span> <span class="o">=</span> <span class="n">grad_X</span><span class="o">/</span><span class="n">norm</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">wall_grad_Y</span> <span class="o">=</span> <span class="n">grad_Y</span><span class="o">/</span><span class="n">norm</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">wall_distance</span> <span class="o">=</span> <span class="mf">1.0e99</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">image_red</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span></div>


<div class="viewcode-block" id="Domain.add_destination">
<a class="viewcode-back" href="../../domain.html#cromosim.domain.Domain.add_destination">[docs]</a>
    <span class="k">def</span> <span class="nf">add_destination</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dest</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;To compute the desired velocities to this destination</span>
<span class="sd">        and then to add this Destination object to this domain.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        dest: Destination</span>
<span class="sd">            contains the Destination object which must be added to this domain</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Compute mask for dest.excluded_colors (which can be for example the</span>
        <span class="c1"># wall colors...)</span>
        <span class="n">excluded_color_mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">image_red</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">dest</span><span class="o">.</span><span class="n">excluded_colors</span><span class="p">:</span>
            <span class="n">excluded_color_mask</span> <span class="o">+=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">image_red</span> <span class="o">==</span> <span class="n">c</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> \
                <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">image_green</span> <span class="o">==</span> <span class="n">c</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> \
                <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">image_blue</span> <span class="o">==</span> <span class="n">c</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
        <span class="n">excluded_color_id</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">excluded_color_mask</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>

        <span class="c1"># Compute mask for dest.colors (which correspond which correspond to</span>
        <span class="c1"># the destination of the people)</span>
        <span class="n">dest_mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">image_red</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">ic</span><span class="p">,</span> <span class="n">rgb</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">dest</span><span class="o">.</span><span class="n">colors</span><span class="p">):</span>
            <span class="n">dest_mask</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">image_red</span> <span class="o">==</span> <span class="n">rgb</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> \
                <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">image_green</span> <span class="o">==</span> <span class="n">rgb</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> \
                <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">image_blue</span> <span class="o">==</span> <span class="n">rgb</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
        <span class="n">mask_id</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">((</span><span class="n">dest_mask</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">))</span>

        <span class="c1"># Define rhs of the Eikonal equation (i.e. the speed)</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">dest</span><span class="o">.</span><span class="n">fmm_speed</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">dest</span><span class="o">.</span><span class="n">fmm_speed</span><span class="o">.</span><span class="n">shape</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">image_red</span><span class="o">.</span><span class="n">shape</span><span class="p">):</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Bad speed shape ! Failed to compute the destination distance...&quot;</span><span class="p">)</span>
                <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">dest</span><span class="o">.</span><span class="n">fmm_speed</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">image_red</span><span class="p">)</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">mask_id</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">size</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span>
            <span class="n">dest_mask</span><span class="p">[</span><span class="n">mask_id</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">phi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">image_red</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
            <span class="n">phi</span><span class="p">[</span><span class="n">mask_id</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>

            <span class="n">phi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">MaskedArray</span><span class="p">(</span><span class="n">phi</span><span class="p">,</span> <span class="n">mask</span><span class="o">=</span><span class="n">excluded_color_mask</span><span class="p">)</span>
            <span class="n">dest</span><span class="o">.</span><span class="n">distance</span> <span class="o">=</span> <span class="n">skfmm</span><span class="o">.</span><span class="n">travel_time</span><span class="p">(</span><span class="n">phi</span><span class="p">,</span> <span class="n">dest</span><span class="o">.</span><span class="n">fmm_speed</span><span class="p">,</span> <span class="n">dx</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">pixel_size</span><span class="p">)</span>
            <span class="c1"># dest.distance = skfmm.distance(phi, dx=self.pixel_size)</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">excluded_color_id</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">size</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span>
                <span class="n">tmp_dist</span> <span class="o">=</span> <span class="n">dest</span><span class="o">.</span><span class="n">distance</span><span class="o">.</span><span class="n">filled</span><span class="p">(</span><span class="mi">9999</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">tmp_dist</span> <span class="o">=</span> <span class="n">dest</span><span class="o">.</span><span class="n">distance</span>
            <span class="n">grad</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">gradient</span><span class="p">(</span><span class="n">tmp_dist</span><span class="p">,</span> <span class="n">edge_order</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">dest</span><span class="o">.</span><span class="n">distance</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">image_red</span><span class="p">)</span>
            <span class="n">grad</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">gradient</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">image_red</span><span class="p">),</span> <span class="n">edge_order</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">rgbgrad</span> <span class="ow">in</span> <span class="n">dest</span><span class="o">.</span><span class="n">desired_velocity_from_color</span><span class="p">:</span>
            <span class="n">test</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">image_red</span> <span class="o">==</span> <span class="nb">int</span><span class="p">(</span><span class="n">rgbgrad</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span> \
                <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">image_green</span> <span class="o">==</span> <span class="nb">int</span><span class="p">(</span><span class="n">rgbgrad</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span> \
                <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">image_blue</span> <span class="o">==</span> <span class="nb">int</span><span class="p">(</span><span class="n">rgbgrad</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>
            <span class="n">indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">test</span><span class="p">)</span>
            <span class="n">grad</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">indices</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">rgbgrad</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
            <span class="n">grad</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">indices</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">rgbgrad</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span>

        <span class="n">grad_X</span> <span class="o">=</span> <span class="o">-</span><span class="n">grad</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">pixel_size</span>
        <span class="n">grad_Y</span> <span class="o">=</span> <span class="o">-</span><span class="n">grad</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">pixel_size</span>
        <span class="n">norm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">grad_X</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">grad_Y</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">norm</span> <span class="o">=</span> <span class="p">(</span><span class="n">norm</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span><span class="o">*</span><span class="n">norm</span> <span class="o">+</span> <span class="p">(</span><span class="n">norm</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span><span class="o">*</span><span class="mf">0.001</span>
        <span class="n">dest</span><span class="o">.</span><span class="n">desired_velocity_X</span> <span class="o">=</span> <span class="n">grad_X</span><span class="o">/</span><span class="n">norm</span>
        <span class="n">dest</span><span class="o">.</span><span class="n">desired_velocity_Y</span> <span class="o">=</span> <span class="n">grad_Y</span><span class="o">/</span><span class="n">norm</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">destinations</span><span class="p">[</span><span class="n">dest</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">dest</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">destinations</span> <span class="o">=</span> <span class="p">{</span><span class="n">dest</span><span class="o">.</span><span class="n">name</span><span class="p">:</span> <span class="n">dest</span><span class="p">}</span></div>


<div class="viewcode-block" id="Domain.people_desired_velocity">
<a class="viewcode-back" href="../../domain.html#cromosim.domain.Domain.people_desired_velocity">[docs]</a>
    <span class="k">def</span> <span class="nf">people_desired_velocity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">xyr</span><span class="p">,</span> <span class="n">people_dest</span><span class="p">,</span> <span class="n">II</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">JJ</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;This function determines people desired velocities from the desired \</span>
<span class="sd">        velocity array computed by Domain thanks to a fast-marching method.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        xyr: numpy array</span>
<span class="sd">            people coordinates and radius: x,y,r</span>
<span class="sd">        people_dest: list of string</span>
<span class="sd">            destination for each individual</span>
<span class="sd">        II: numpy array (None by default)</span>
<span class="sd">            people index i</span>
<span class="sd">        JJ: numpy array (None by default)</span>
<span class="sd">            people index j</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        II: numpy array</span>
<span class="sd">            people index i</span>
<span class="sd">        JJ: numpy array</span>
<span class="sd">            people index j</span>
<span class="sd">        Vd: numpy array</span>
<span class="sd">            people desired velocity</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="p">((</span><span class="n">II</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">JJ</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)):</span>
            <span class="n">II</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">((</span><span class="n">xyr</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">ymin</span><span class="o">-</span><span class="mf">0.5</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">pixel_size</span><span class="p">)</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">pixel_size</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
            <span class="n">JJ</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">((</span><span class="n">xyr</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">xmin</span><span class="o">-</span><span class="mf">0.5</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">pixel_size</span><span class="p">)</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">pixel_size</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
        <span class="n">Vd</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">xyr</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">2</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">dest_name</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">people_dest</span><span class="p">):</span>
            <span class="n">ind</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">people_dest</span><span class="p">)</span> <span class="o">==</span> <span class="n">dest_name</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">scale</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">destinations</span><span class="p">[</span><span class="n">dest_name</span><span class="p">]</span><span class="o">.</span><span class="n">velocity_scale</span>
            <span class="n">Vd</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">xyr</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span><span class="o">*</span><span class="n">scale</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">destinations</span><span class="p">[</span><span class="n">dest_name</span><span class="p">]</span><span class="o">.</span><span class="n">desired_velocity_X</span><span class="p">[</span><span class="n">II</span><span class="p">[</span><span class="n">ind</span><span class="p">],</span> <span class="n">JJ</span><span class="p">[</span><span class="n">ind</span><span class="p">]]</span>
            <span class="n">Vd</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">xyr</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span><span class="o">*</span><span class="n">scale</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">destinations</span><span class="p">[</span><span class="n">dest_name</span><span class="p">]</span><span class="o">.</span><span class="n">desired_velocity_Y</span><span class="p">[</span><span class="n">II</span><span class="p">[</span><span class="n">ind</span><span class="p">],</span> <span class="n">JJ</span><span class="p">[</span><span class="n">ind</span><span class="p">]]</span>
        <span class="k">return</span> <span class="n">II</span><span class="p">,</span> <span class="n">JJ</span><span class="p">,</span> <span class="n">Vd</span></div>


<div class="viewcode-block" id="Domain.people_target_distance">
<a class="viewcode-back" href="../../domain.html#cromosim.domain.Domain.people_target_distance">[docs]</a>
    <span class="k">def</span> <span class="nf">people_target_distance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">xyr</span><span class="p">,</span> <span class="n">people_dest</span><span class="p">,</span> <span class="n">II</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">JJ</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;This function determines distances to the current target for all people</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        xyr: numpy array</span>
<span class="sd">            people coordinates and radius: ``x,y,r``</span>
<span class="sd">        people_dest: list of string</span>
<span class="sd">            destination for each individual</span>
<span class="sd">        II: numpy array (None by default)</span>
<span class="sd">            people index ``i``</span>
<span class="sd">        JJ: numpy array (None by default)</span>
<span class="sd">            people index ``j``</span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        II: numpy array</span>
<span class="sd">            people index i</span>
<span class="sd">        JJ: numpy array</span>
<span class="sd">            people index j</span>
<span class="sd">        D: numpy array</span>
<span class="sd">            distances to the current target</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="p">((</span><span class="n">II</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">JJ</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)):</span>
            <span class="n">II</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">((</span><span class="n">xyr</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">ymin</span><span class="o">-</span><span class="mf">0.5</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">pixel_size</span><span class="p">)</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">pixel_size</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
            <span class="n">JJ</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">((</span><span class="n">xyr</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">xmin</span><span class="o">-</span><span class="mf">0.5</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">pixel_size</span><span class="p">)</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">pixel_size</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
        <span class="n">D</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">xyr</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">for</span> <span class="n">dest_name</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">people_dest</span><span class="p">):</span>
            <span class="n">ind</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">people_dest</span><span class="p">)</span> <span class="o">==</span> <span class="n">dest_name</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">D</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">destinations</span><span class="p">[</span><span class="n">dest_name</span><span class="p">]</span><span class="o">.</span><span class="n">distance</span><span class="p">[</span><span class="n">II</span><span class="p">[</span><span class="n">ind</span><span class="p">],</span> <span class="n">JJ</span><span class="p">[</span><span class="n">ind</span><span class="p">]]</span><span class="o">-</span><span class="n">xyr</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">II</span><span class="p">,</span> <span class="n">JJ</span><span class="p">,</span> <span class="n">D</span></div>


<div class="viewcode-block" id="Domain.people_wall_distance">
<a class="viewcode-back" href="../../domain.html#cromosim.domain.Domain.people_wall_distance">[docs]</a>
    <span class="k">def</span> <span class="nf">people_wall_distance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">xyr</span><span class="p">,</span> <span class="n">II</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">JJ</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;This function determines distances to the nearest wall for all people</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        xyr: numpy array</span>
<span class="sd">            people coordinates and radius: ``x,y,r``</span>
<span class="sd">        II: numpy array (None by default)</span>
<span class="sd">            people index ``i``</span>
<span class="sd">        JJ: numpy array (None by default)</span>
<span class="sd">            people index ``j``</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        II: numpy array</span>
<span class="sd">            people index ``i``</span>
<span class="sd">        JJ: numpy array</span>
<span class="sd">            people index ``j``</span>
<span class="sd">        D: numpy array</span>
<span class="sd">            distances to the nearest wall</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="p">((</span><span class="n">II</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">JJ</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)):</span>
            <span class="n">II</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">((</span><span class="n">xyr</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">ymin</span><span class="o">-</span><span class="mf">0.5</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">pixel_size</span><span class="p">)</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">pixel_size</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
            <span class="n">JJ</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">((</span><span class="n">xyr</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">xmin</span><span class="o">-</span><span class="mf">0.5</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">pixel_size</span><span class="p">)</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">pixel_size</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
        <span class="n">D</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">wall_distance</span><span class="p">[</span><span class="n">II</span><span class="p">,</span> <span class="n">JJ</span><span class="p">]</span><span class="o">-</span><span class="n">xyr</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">II</span><span class="p">,</span> <span class="n">JJ</span><span class="p">,</span> <span class="n">D</span></div>


<div class="viewcode-block" id="Domain.plot">
<a class="viewcode-back" href="../../domain.html#cromosim.domain.Domain.plot">[docs]</a>
    <span class="k">def</span> <span class="nf">plot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">savefig</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="s1">&#39;fig.png&#39;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">150</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;To plot the computational domain</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        id: integer</span>
<span class="sd">            Figure id (number)</span>
<span class="sd">        title: string</span>
<span class="sd">            Figure title</span>
<span class="sd">        savefig: boolean</span>
<span class="sd">            writes the figure as a png file if true</span>
<span class="sd">        filename: string</span>
<span class="sd">            png filename used to write the figure</span>
<span class="sd">        dpi: integer</span>
<span class="sd">            number of pixel per inch for the saved figure</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="nb">id</span><span class="p">)</span>
        <span class="n">ax1</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>
        <span class="n">ax1</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">image</span><span class="p">,</span> <span class="n">interpolation</span><span class="o">=</span><span class="s1">&#39;nearest&#39;</span><span class="p">,</span> <span class="n">extent</span><span class="o">=</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">xmin</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">xmax</span><span class="p">,</span>
                   <span class="bp">self</span><span class="o">.</span><span class="n">ymin</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ymax</span><span class="p">],</span> <span class="n">origin</span><span class="o">=</span><span class="s1">&#39;lower&#39;</span><span class="p">)</span>
        <span class="c1"># plt.savefig(&#39;.png&#39;,dpi=dpi)</span>
        <span class="c1"># ax1.axes.get_xaxis().set_visible(False)</span>
        <span class="c1"># ax1.axes.get_xaxis().set_visible(False)</span>
        <span class="n">ax1</span><span class="o">.</span><span class="n">set_axis_off</span><span class="p">()</span>
        <span class="n">ax1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>
        <span class="c1"># fig.add_axes(ax1)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">savefig</span><span class="p">):</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="n">dpi</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">,</span> <span class="n">pad_inches</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span></div>


<div class="viewcode-block" id="Domain.plot_wall_dist">
<a class="viewcode-back" href="../../domain.html#cromosim.domain.Domain.plot_wall_dist">[docs]</a>
    <span class="k">def</span> <span class="nf">plot_wall_dist</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                       <span class="n">step</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">scale_units</span><span class="o">=</span><span class="s1">&#39;inches&#39;</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
                       <span class="n">savefig</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="s1">&#39;fig.png&#39;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">150</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;To plot the wall distances</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        id: integer</span>
<span class="sd">            Figure id (number)</span>
<span class="sd">        title: string</span>
<span class="sd">            Figure title</span>
<span class="sd">        savefig: boolean</span>
<span class="sd">            writes the figure as a png file if true</span>
<span class="sd">        filename: string</span>
<span class="sd">            png filename used to write the figure</span>
<span class="sd">        dpi: integer</span>
<span class="sd">            number of pixel per inch for the saved figure</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="nb">id</span><span class="p">)</span>
        <span class="n">ax1</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>
        <span class="n">ax1</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">image</span><span class="p">,</span> <span class="n">interpolation</span><span class="o">=</span><span class="s1">&#39;nearest&#39;</span><span class="p">,</span>
                   <span class="n">extent</span><span class="o">=</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">xmin</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">xmax</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ymin</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ymax</span><span class="p">],</span> <span class="n">origin</span><span class="o">=</span><span class="s1">&#39;lower&#39;</span><span class="p">)</span>
        <span class="n">ax1</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">wall_distance</span><span class="p">,</span> <span class="n">interpolation</span><span class="o">=</span><span class="s1">&#39;nearest&#39;</span><span class="p">,</span>
                   <span class="n">extent</span><span class="o">=</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">xmin</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">xmax</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ymin</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ymax</span><span class="p">],</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span>
                   <span class="n">origin</span><span class="o">=</span><span class="s1">&#39;lower&#39;</span><span class="p">)</span>
        <span class="n">ax1</span><span class="o">.</span><span class="n">quiver</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">X</span><span class="p">[::</span><span class="n">step</span><span class="p">,</span> <span class="p">::</span><span class="n">step</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">Y</span><span class="p">[::</span><span class="n">step</span><span class="p">,</span> <span class="p">::</span><span class="n">step</span><span class="p">],</span>
                   <span class="bp">self</span><span class="o">.</span><span class="n">wall_grad_X</span><span class="p">[::</span><span class="n">step</span><span class="p">,</span> <span class="p">::</span><span class="n">step</span><span class="p">],</span>
                   <span class="bp">self</span><span class="o">.</span><span class="n">wall_grad_Y</span><span class="p">[::</span><span class="n">step</span><span class="p">,</span> <span class="p">::</span><span class="n">step</span><span class="p">],</span>
                   <span class="n">scale</span><span class="o">=</span><span class="n">scale</span><span class="p">,</span> <span class="n">scale_units</span><span class="o">=</span><span class="n">scale_units</span><span class="p">)</span>
        <span class="n">ax1</span><span class="o">.</span><span class="n">set_axis_off</span><span class="p">()</span>
        <span class="n">ax1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>
        <span class="c1"># plt.savefig(&#39;.png&#39;,dpi=dpi)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">savefig</span><span class="p">):</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="n">dpi</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">,</span> <span class="n">pad_inches</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span></div>


<div class="viewcode-block" id="Domain.plot_desired_velocity">
<a class="viewcode-back" href="../../domain.html#cromosim.domain.Domain.plot_desired_velocity">[docs]</a>
    <span class="k">def</span> <span class="nf">plot_desired_velocity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                              <span class="n">destination_name</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">scale_units</span><span class="o">=</span><span class="s1">&#39;inches&#39;</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                              <span class="n">title</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">savefig</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="s1">&#39;fig.png&#39;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">150</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;To plot the desired velocity</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        destination_name: string</span>
<span class="sd">            name of the considered destination</span>
<span class="sd">        step: integer</span>
<span class="sd">            draw an arrow every step pixels</span>
<span class="sd">        scale: integer</span>
<span class="sd">            scaling for the quiver arrows</span>
<span class="sd">        scale_units: string</span>
<span class="sd">            unit name for quiver arrow scaling</span>
<span class="sd">        id: integer</span>
<span class="sd">            Figure id (number)</span>
<span class="sd">        title: string</span>
<span class="sd">            Figure title</span>
<span class="sd">        savefig: boolean</span>
<span class="sd">            writes the figure as a png file if true</span>
<span class="sd">        filename: string</span>
<span class="sd">            png filename used to write the figure</span>
<span class="sd">        dpi: integer</span>
<span class="sd">            number of pixel per inch for the saved figure</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="nb">id</span><span class="p">)</span>
        <span class="n">ax1</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>
        <span class="n">ax1</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">image</span><span class="p">,</span> <span class="n">interpolation</span><span class="o">=</span><span class="s1">&#39;nearest&#39;</span><span class="p">,</span>
                   <span class="n">extent</span><span class="o">=</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">xmin</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">xmax</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ymin</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ymax</span><span class="p">],</span> <span class="n">origin</span><span class="o">=</span><span class="s1">&#39;lower&#39;</span><span class="p">)</span>
        <span class="n">ax1</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">destinations</span><span class="p">[</span><span class="n">destination_name</span><span class="p">]</span><span class="o">.</span><span class="n">distance</span><span class="p">,</span> <span class="n">interpolation</span><span class="o">=</span><span class="s1">&#39;nearest&#39;</span><span class="p">,</span>
                   <span class="n">extent</span><span class="o">=</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">xmin</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">xmax</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ymin</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ymax</span><span class="p">],</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span>
                   <span class="n">origin</span><span class="o">=</span><span class="s1">&#39;lower&#39;</span><span class="p">)</span>
        <span class="n">ax1</span><span class="o">.</span><span class="n">quiver</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">X</span><span class="p">[::</span><span class="n">step</span><span class="p">,</span> <span class="p">::</span><span class="n">step</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">Y</span><span class="p">[::</span><span class="n">step</span><span class="p">,</span> <span class="p">::</span><span class="n">step</span><span class="p">],</span>
                   <span class="bp">self</span><span class="o">.</span><span class="n">destinations</span><span class="p">[</span><span class="n">destination_name</span><span class="p">]</span><span class="o">.</span><span class="n">desired_velocity_X</span><span class="p">[::</span><span class="n">step</span><span class="p">,</span> <span class="p">::</span><span class="n">step</span><span class="p">],</span>
                   <span class="bp">self</span><span class="o">.</span><span class="n">destinations</span><span class="p">[</span><span class="n">destination_name</span><span class="p">]</span><span class="o">.</span><span class="n">desired_velocity_Y</span><span class="p">[::</span><span class="n">step</span><span class="p">,</span> <span class="p">::</span><span class="n">step</span><span class="p">],</span>
                   <span class="n">scale</span><span class="o">=</span><span class="n">scale</span><span class="p">,</span> <span class="n">scale_units</span><span class="o">=</span><span class="n">scale_units</span><span class="p">)</span>
        <span class="n">ax1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>
        <span class="c1"># plt.savefig(&#39;.png&#39;,dpi=dpi)</span>
        <span class="n">ax1</span><span class="o">.</span><span class="n">set_axis_off</span><span class="p">()</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">savefig</span><span class="p">):</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="n">dpi</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">,</span> <span class="n">pad_inches</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span></div>


    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;To print the main caracteristics of a Domain object</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="s2">&quot;--&gt; &quot;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span>  \
            <span class="o">+</span> <span class="s2">&quot;:</span><span class="se">\n</span><span class="s2">    dimensions: [&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">xmin</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;,&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">xmax</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;]x[&quot;</span> \
            <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ymin</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;,&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ymax</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;]&quot;</span> \
            <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">    width: &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">width</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot; height: &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">height</span><span class="p">)</span> \
            <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">    background image: &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__background</span><span class="p">)</span> \
            <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">    image of the domain: &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__image_filename</span><span class="p">)</span> \
            <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">    wall_colors: &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">wall_colors</span><span class="p">)</span> \
            <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">    destinations: &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">destinations</span><span class="p">)</span></div>

</pre></div>

        </div>
      </div>
    </div>

    <div class="footer" role="contentinfo">
    &#169; Copyright 2018, Sylvain Faure, Bertrand Maury.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 8.1.3.
    </div>
  </body>
</html>