import{u as p,K as C,o as F,a as c,R as e,c as k,D as G,T as $,d as S,M as w,e as N,B as x,j as R}from"./index-ohkpUfgU.js";const M={flagInclude:0,flagExclude:1540},P={flagInclude:16,flagExclude:1540},b={flagInclude:0,flagExclude:1556};async function V({self:o,tag:s,blocks:u,opts:a}){const{rpcManager:m}=p.getSession(o),{adapterConfig:i}=o,f=C.getRpcSessionId(o);return await m.call(C.getRpcSessionId(o),"PileupGetGlobalValueForTag",{adapterConfig:i,tag:s,sessionId:f,regions:u.contentBlocks,...a})}const j=F(function(o){const{model:s,handleClose:u}=o,[a,m]=c.useState(""),[i,f]=c.useState(),[v,h]=c.useState(!1),[T,I]=c.useState(),A=/^[A-Za-z][A-Za-z0-9]$/.exec(a),d=a.length===2&&!A,L=p.useDebounce(a,1e3),[g,B]=c.useState("");return c.useEffect(()=>{(async()=>{try{if(!d){I(void 0),h(!0);const t=await V({self:s,tag:L,blocks:p.getContainingView(s).staticBlocks});f(t)}}catch(t){console.error(t),I(t)}finally{h(!1)}})()},[s,d,L]),e.createElement(k.Dialog,{open:!0,onClose:u,title:"Group by"},e.createElement(G,null,e.createElement($,null,'NOTE: this will create new session tracks with the "filter by" set to the values chosen here rather than affecting the current track state'),e.createElement(S,{fullWidth:!0,value:g,onChange:t=>{B(t.target.value)},label:"Group by...",select:!0},e.createElement(w,{value:"strand"},"Strand"),e.createElement(w,{value:"tag"},"Tag")),g==="tag"?e.createElement(e.Fragment,null,e.createElement($,{color:"textSecondary"},"Examples: HP for haplotype, RG for read group, etc."),e.createElement(S,{value:a,onChange:t=>{m(t.target.value)},placeholder:"Enter tag name",error:d,helperText:d?"Not a valid tag":"",autoComplete:"off","data-testid":"group-tag-name",slotProps:{htmlInput:{maxLength:2,"data-testid":"group-tag-name-input"}}}),T?e.createElement(k.ErrorMessage,{error:T}):v?e.createElement(k.LoadingEllipses,{title:"Loading unique tags"}):i?e.createElement("div",null,e.createElement("div",null,"Found unique ",a," values:"),e.createElement("div",null,i.join(", "))):null):null),e.createElement(N,null,e.createElement(x,{variant:"contained",color:"primary",type:"submit",disabled:!i,autoFocus:!0,onClick:()=>{const t=p.getContainingTrack(s),n=structuredClone(R(t.configuration)),D=p.getSession(s),E=p.getContainingView(s);if(g==="tag"){if(i){const r=[...i,void 0];for(const l of r){const y=`${n.trackId}-${a}:${l}-${+Date.now()}-sessionTrack`;D.addTrackConf({...n,trackId:y,name:`${n.name} (-)`,displays:[{displayId:`${y}-LinearAlignmentsDisplay`,type:"LinearAlignmentsDisplay",pileupDisplay:{displayId:`${y}-LinearAlignmentsDisplay-LinearPileupDisplay`,type:"LinearPileupDisplay",filterBy:{...M,tagFilter:{tag:a,value:l}}}}]}),E.showTrack(y)}}}else if(g==="strand"){const r=`${n.trackId}-${a}:(-)-${+Date.now()}-sessionTrack`,l=`${n.trackId}-${a}:(+)-${+Date.now()}-sessionTrack`;D.addTrackConf({...n,trackId:r,name:`${n.name} (-)`,displays:[{displayId:`${r}-LinearAlignmentsDisplay`,type:"LinearAlignmentsDisplay",pileupDisplay:{displayId:`${r}-LinearAlignmentsDisplay-LinearPileupDisplay`,type:"LinearPileupDisplay",filterBy:P}},{displayId:`${r}-LinearSNPCoverageDisplay`,type:"LinearSNPCoverageDisplay",filterBy:P}]}),D.addTrackConf({...n,trackId:l,name:`${n.name} (+)`,displays:[{displayId:`${l}-LinearAlignmentsDisplay`,type:"LinearAlignmentsDisplay",pileupDisplay:{displayId:`${l}-LinearAlignmentsDisplay-LinearPileupDisplay`,type:"LinearPileupDisplay",filterBy:b}},{displayId:`${l}-LinearSNPCoverageDisplay`,type:"LinearSNPCoverageDisplay",filterBy:b}]}),E.showTrack(r),E.showTrack(l)}u()}},"Submit"),e.createElement(x,{variant:"contained",color:"secondary",onClick:()=>{u()}},"Cancel")))});export{j as default};
