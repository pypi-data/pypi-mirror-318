import{m as S,o as R,R as e,S as I,U as H,V as B,W as N,X as P,J as T,a as g,P as A,a0 as G,u as b,c as M,B as E,Y as F,Z as O,_ as j,$ as U,T as W,d as _,at as L,D as $,e as K}from"./index-ohkpUfgU.js";import{D as V}from"./cjs-CNO6nbbG.js";import{a as z,C as Y}from"./ColorPicker-O3H7x8oo.js";function J(t){let l=0;for(let a=0;a<t.length;a++)l+=t.charCodeAt(a);return`hsl(${l*10}, 20%, 50%)`}const X=S()(t=>({closeButton:{position:"absolute",right:t.spacing(1),top:t.spacing(1),color:t.palette.grey[500]}}));function Z(t){const l=g.useRef(null);return e.createElement(V,{nodeRef:l,cancel:'[class*="MuiDialogContent-root"]',onStart:a=>{var o,r;return(r=(o=a.target)===null||o===void 0?void 0:o.className)===null||r===void 0?void 0:r.includes("MuiDialogTitle")}},e.createElement(A,{ref:l,...t}))}const q=R(function(l){const{classes:a}=X(),{title:o,children:r,onClose:s}=l;return e.createElement(I,{...l,PaperComponent:Z},e.createElement(H,null,e.createElement(B,{style:{cursor:"move"}},o,s?e.createElement(N,{className:a.closeButton,onClick:()=>{s()}},e.createElement(P,null)):null),e.createElement(T,null),r))});function y(t,l,a=1){const o=l.map(s=>t.findIndex(n=>n.name===s)).sort((s,n)=>s-n);let r=0;for(const s of o){const n=Math.max(r,s-a);n>=r&&t.splice(n,0,t.splice(s,1)[0]),r=r+1}return t}function D(t,l,a=1){const o=l.map(s=>t.findIndex(n=>n.name===s)).sort((s,n)=>n-s);let r=t.length-1;for(const s of o){const n=Math.min(r,s+a);n<=r&&t.splice(n,0,t.splice(s,1)[0]),r=r-1}return t}const Q=S()({cell:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"}});function ee({rows:t,onChange:l,showTips:a}){const{classes:o}=Q(),[r,s]=g.useState([]),{name:n,color:c,baseUri:u,...m}=t[0],[h,i]=g.useState({idx:0,field:null});return e.createElement("div",null,e.createElement(te,{selected:r,rows:t,showTips:a,onChange:l}),e.createElement("div",{style:{height:400,width:"100%"}},e.createElement(G,{getRowId:d=>d.name,checkboxSelection:!0,disableRowSelectionOnClick:!0,onRowSelectionModelChange:d=>{s(d)},rows:t,rowHeight:25,columnHeaderHeight:33,columns:[{field:"color",headerName:"Color",renderCell:d=>{const{value:p,id:C}=d;return e.createElement(z,{color:p||"blue",onChange:f=>{const v=t.find(w=>w.name===C);v&&(v.color=f),l([...t])}})}},{field:"name",headerName:"Name",width:b.measureGridWidth(t.map(d=>d.name))},...Object.keys(m).map(d=>({field:d,renderCell:({value:p})=>e.createElement("div",{className:o.cell},e.createElement(M.SanitizedHTML,{html:b.getStr(p)})),width:b.measureGridWidth(t.map(p=>`${p[d]}`))}))],sortModel:[],onSortModelChange:d=>{const p=d[0],C=(h.idx+1)%2,f=p.field||h.field;i({idx:C,field:f}),l(f?[...t].sort((v,w)=>{const k=b.getStr(v[f]),x=b.getStr(w[f]);return C===1?k.localeCompare(x):x.localeCompare(k)}):t)}})))}function te({selected:t,onChange:l,rows:a,showTips:o}){const[r,s]=g.useState(null),[n,c]=g.useState("blue");return e.createElement(e.Fragment,null,e.createElement(E,{disabled:!t.length,onClick:u=>{s(u.currentTarget)}},"Change color of selected items"),e.createElement(E,{onClick:()=>{l(y([...a],t))},disabled:!t.length},e.createElement(F,null),o?"Move selected items up":null),e.createElement(E,{onClick:()=>{l(D([...a],t))},disabled:!t.length},e.createElement(O,null),o?"Move selected items down":null),e.createElement(E,{onClick:()=>{l(y([...a],t,a.length))},disabled:!t.length},e.createElement(j,null),o?"Move selected items to top":null),e.createElement(E,{onClick:()=>{l(D([...a],t,a.length))},disabled:!t.length},e.createElement(U,null),o?"Move selected items to bottom":null),e.createElement(Y.ColorPopover,{anchorEl:r,color:n,onChange:u=>{c(u),t.forEach(m=>{const h=a.find(i=>i.name===m);h&&(h.color=u)}),l([...a])},onClose:()=>{s(null)}}))}const ne=S()({textAreaFont:{fontFamily:"Courier New"}});function le({setCurrLayout:t,currLayout:l}){const{classes:a}=ne(),[o,r]=g.useState(""),[s,n]=g.useState();return e.createElement("div",null,e.createElement(W,null,'Paste CSV or TSV. If a header column is present. First line is a header. If a column called "name" is present, it uses that to connect to IDs in the table, otherwise it uses the first column no.'),e.createElement(_,{variant:"outlined",multiline:!0,minRows:5,placeholder:`name,population
HG00098,GBR
HG00101,GBR
HG00459,CHS
...`,maxRows:10,fullWidth:!0,value:o,onChange:c=>{r(c.target.value)},slotProps:{input:{classes:{input:a.textAreaFont}}}}),e.createElement(E,{variant:"contained",onClick:()=>{const c=o.split(`
`).map(m=>m.trim()).filter(m=>!!m),u=c[0].split(/[,\t]/gm);if(u.includes("name")){n("");const m=l.map(i=>[i.name,i]),h=Object.fromEntries(c.slice(1).map(i=>{const d=i.split(/[,\t]/gm),p=Object.fromEntries(d.map((C,f)=>[u[f],C]));return[p.name,{...p,...m[p.name]}]}));t(l.map(i=>({...i,...h[i.name]})))}else n(new Error('No "name" column found on line 1'))}},"Update rows"),e.createElement(E,{variant:"contained",onClick:()=>{const c=o.split(`
`).map(m=>m.trim()).filter(m=>!!m),u=c[0].split(/[,\t]/gm);if(u.includes("name")){n("");const m=l.map(i=>[i.name,i]),h=Object.fromEntries(c.slice(1).map(i=>{const d=i.split(/[,\t]/gm),p=Object.fromEntries(d.map((C,f)=>[u[f],C]));return[p.name,{...p,...m[p.name]}]}));t(l.map(i=>({...h[i.name]})))}else n(new Error('No "name" column found on line 1'))}},"Replace rows"),s?e.createElement(M.ErrorMessage,{error:s}):null)}function oe({setCurrLayout:t,currLayout:l}){var a;return e.createElement("div",null,Object.keys((a=l[0])!==null&&a!==void 0?a:[]).filter(o=>o!=="name"&&o!=="color").map(o=>e.createElement(E,{key:o,onClick:()=>{const r=new Map;for(const n of l){const c=r.get(n[o]);c?r.set(n[o],c+1):r.set(n[o],1)}const s=Object.fromEntries([...r.entries()].sort((n,c)=>n[1]-c[1]).map((n,c)=>[n[0],L.set1[c]||J(n[0])]));t(l.map(n=>({...n,color:s[n[o]]})))}},"Palettize ",o)))}const ae=S()({content:{minWidth:800},fr:{float:"right"},textAreaFont:{fontFamily:"Courier New"}});function me({model:t,handleClose:l}){const{classes:a}=ae(),{sources:o}=t,[r,s]=g.useState(!1),[n,c]=g.useState(o||[]),[u,m]=b.useLocalStorage("multivariant-showTips",!1);return e.createElement(q,{open:!0,onClose:l,maxWidth:"xl",title:"Multi-variant color/arrangement editor"},e.createElement($,{className:a.content},e.createElement("div",{className:a.fr},e.createElement(E,{variant:"contained",onClick:()=>{m(!u)}},u?"Hide tips":"Show tips"),e.createElement(E,{color:"secondary",variant:"contained",onClick:()=>{s(!r)}},r?"Hide bulk row editor":"Show Bulk row editor")),e.createElement("br",null),u?e.createElement(re,null):null,r?e.createElement(le,{currLayout:n,setCurrLayout:c}):null,e.createElement(oe,{currLayout:n,setCurrLayout:c}),e.createElement(ee,{rows:n,onChange:c,showTips:u})),e.createElement(K,null,e.createElement(E,{variant:"contained",type:"submit",color:"inherit",onClick:()=>{t.clearLayout(),c(t.sources||[])}},"Clear custom settings"),e.createElement(E,{variant:"contained",color:"secondary",onClick:()=>{l(),c([...t.sources||[]])}},"Cancel"),e.createElement(E,{variant:"contained",color:"primary",type:"submit",onClick:()=>{t.setLayout(n),l()}},"Submit")))}function re(){return e.createElement(e.Fragment,null,"Helpful tips",e.createElement("ul",null,e.createElement("li",null,"You can select rows in the table with the checkboxes"),e.createElement("li",null,"Multi-select is enabled with shift-click and control-click"),e.createElement("li",null,'The "Move selected items up/down" can re-arrange subtracks'),e.createElement("li",null,"Sorting the data grid itself can also re-arrange subtracks"),e.createElement("li",null,"Changes are applied when you hit Submit"),e.createElement("li",null,"You can click and drag the dialog box to move it on the screen"),e.createElement("li",null,"Columns in the table can be hidden using a vertical '...' menu on the right side of each column")))}export{me as default};
