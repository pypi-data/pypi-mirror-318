"use strict";(self["webpackChunkSimple_Web_based_Interface_for_Scanner"]=self["webpackChunkSimple_Web_based_Interface_for_Scanner"]||[]).push([[129],{7129:(e,t,o)=>{o.r(t),o.d(t,{default:()=>I});var i=o(3673),a=o(2323);const n={class:"full-width justify-center items-center q-my-sm"},r=(0,i.Uk)("Click to pick a file"),l={key:1},s={class:"row justify-center q-mt-lg q-mb-md"},c={style:{position:"relative"}},d=["src"],u={class:"col justify-center"},p={class:"q-mr-md q-mb-md"},g={style:{"margin-bottom":"5pt"}},m=["href"],h=(0,i.Uk)(" Download "),f={class:"text-center q-ml-md q-mb-md"},_=(0,i._)("div",{style:{"font-size":"1.5rem"}},"Set aspect ratio",-1);function y(e,t,o,y,v,w){const b=(0,i.up)("q-circular-progress"),q=(0,i.up)("q-uploader-add-trigger"),k=(0,i.up)("q-tooltip"),x=(0,i.up)("q-btn"),$=(0,i.up)("q-uploader"),F=(0,i.up)("q-icon"),j=(0,i.up)("q-page");return(0,i.wg)(),(0,i.j4)(j,{class:"col text-center"},{default:(0,i.w5)((()=>[void 0==e.filename?((0,i.wg)(),(0,i.iD)("div",{key:0,style:(0,a.j5)({opacity:e.inProgress?.5:1})},[(0,i._)("div",n,[(0,i.Wm)($,{url:e.upload_url,class:"q-my-md",style:{"min-height":"200px",border:"3pt dashed silver","max-width":"1024px",width:"100%",margin:"auto auto"},color:"transparent","text-color":"black",label:"Upload files","field-name":"file",accept:".jpg, image/*, .pdf","max-files":"1",multiple:!1,"auto-upload":"","with-credentials":"",onUploaded:e.uploaded,onUploading:e.uploading,onFailed:e.uploadFailed,onFactoryFailed:e.factoryFailed,onRejected:e.rejected,onFinish:e.uploadFinish,headers:[{Authorization:`Bearer ${e.token}`}],factory:e.uploadFactory,disable:void 0!=e.image},{header:(0,i.w5)((t=>[(0,i._)("div",{class:(0,a.C_)(["row no-wrap text-grey-4 text-uppercase items-center q-pa-sm q-gutter-xs justify-center items-center",{hidden:t.uploadedFiles.length>0}]),style:{position:"absolute",top:"0px","z-index":"1","font-size":"2.8rem","font-family":"sans-serif","margin-left":"auto","margin-right":"auto",left:"0",right:"0","text-align":"center"}},"Drag & drop here",2),(0,i._)("div",{class:(0,a.C_)(["row no-wrap q-pa-sm q-gutter-xs justify-center items-center",{hidden:t.uploadedFiles.length>0}]),style:{position:"absolute",top:"70px","margin-left":"auto","margin-right":"auto",left:"0",right:"0","z-index":"5"}},[e.fileUploading?((0,i.wg)(),(0,i.j4)(b,{key:0,indeterminate:"",size:"50px",color:"red",thickness:1,"track-color":"grey-3",class:"q-ma-md"})):(0,i.kq)("",!0),t.canAddFiles?((0,i.wg)(),(0,i.j4)(x,{key:1,type:"a",icon:"add_box",label:"Upload file",outline:"",class:"bg-white"},{default:(0,i.w5)((()=>[(0,i.Wm)(q),(0,i.Wm)(k,null,{default:(0,i.w5)((()=>[r])),_:1})])),_:1})):(0,i.kq)("",!0)],2)])),_:1},8,["url","onUploaded","onUploading","onFailed","onFactoryFailed","onRejected","onFinish","headers","factory","disable"])])],4)):(0,i.kq)("",!0),void 0!=e.filename?((0,i.wg)(),(0,i.iD)("div",l,[(0,i._)("div",s,[(0,i._)("div",c,[(0,i._)("img",{ref:"img",src:e.image_url,style:{"max-height":"500px"},crossorigin:"anonymous"},null,8,d)])]),(0,i._)("div",u,[(0,i._)("div",p,[(0,i._)("div",g,[(0,i._)("a",{href:e.image_url,class:"q-my-md",style:{border:"1pt solid black","border-radius":"20pt","font-size":"22pt",padding:"8pt","text-decoration":"none"},download:""},[(0,i.Wm)(F,{name:"download"}),h],8,m)]),(0,i._)("div",null,"Filename: "+(0,a.zw)(e.filename),1)]),(0,i._)("div",f,[_,(0,i._)("div",null,[((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(e.aspectRatios,(t=>((0,i.wg)(),(0,i.j4)(x,{key:t.label,label:t.label,onClick:o=>e.changeAspectRatio(t.x,t.y),class:"q-mx-xs"},null,8,["label","onClick"])))),128))]),e.cropper?((0,i.wg)(),(0,i.j4)(x,{key:0,class:"q-my-lg",label:"crop & save",onClick:e.crop},null,8,["onClick"])):(0,i.kq)("",!0)])])])):(0,i.kq)("",!0)])),_:1})}o(2100),o(812),o(979),o(6105),o(5123),o(8685),o(2396),o(1254);const v=(0,i.aZ)({name:"PageScan",data:function(){return{config:void 0,fileUploading:!1,filename:void 0,format:void 0,formatOptions:["png","jpg"],resolution:void 0,resolutionOptions:["75","100","150","200","250","300","600"],mode:void 0,modeOptions:["color","gray"],inProgress:!1}},computed:{image_url:function(){return`http://${this.config.api_url}:${this.config.api_port}${this.config.scans_url}/${this.filename}`},scan_url:function(){return`http://${this.config.api_url}:${this.config.api_port}/scan/execute`},image_update_url:function(){return`http://${this.config.api_url}:${this.config.api_port}/scan/update`},upload_url:function(){var e,t,o;return null!==(e=`http://${null===this||void 0===this||null===(t=this.config)||void 0===t?void 0:t.api_url}:${null===this||void 0===this||null===(o=this.config)||void 0===o?void 0:o.api_port}/upload`)&&void 0!==e?e:""}},watch:{resolution:function(e){localStorage.setItem("resolution",e)},format:function(e){localStorage.setItem("format",e)},mode:function(e){localStorage.setItem("mode",e)}},created(){var e,t,o;this.resolution=null!==(e=localStorage.getItem("resolution"))&&void 0!==e?e:"150",this.format=null!==(t=localStorage.getItem("format"))&&void 0!==t?t:"png",this.mode=null!==(o=localStorage.getItem("mode"))&&void 0!==o?o:"color",this.randVal=Math.random()},mounted(){this.getJSON("config","config.json").then((e=>{this.config=e}))},methods:{getJSON:function(e,t){return new Promise(((o,i)=>{this.$axios.get(t).then((t=>{let i=t.data;localStorage.setItem(e,JSON.stringify(i)),o(i)})).catch((e=>{this.$q.notify({color:"negative",message:`Error loading ${t}`,icon:"report_problem"}),console.error(e),i(e)}))}))},startScan:function(){this.inProgress=!0,this.$axios.post(this.scan_url,{format:`${this.format}`,resolution:`${this.resolution}`,mode:`${this.mode}`}).then((e=>{console.log(e),0==e.data.code?this.filename=e.data.filename:(this.$q.notify({color:"negative",message:"Error starting scan",icon:"report_problem"}),console.error(e)),this.inProgress=!1})).catch((e=>{this.$q.notify({color:"negative",message:"Error starting scan",icon:"report_problem"}),console.error(e),this.inProgress=!1}))},dataURLtoFile:function(e,t){const o=e.split(","),i=o[0].match(/:(.*?);/)[1],a=atob(o[1]);let n=a.length;const r=new Uint8Array(n);while(n)r[n-1]=a.charCodeAt(n-1),n-=1;return new File([r],t,{type:i})},reloadImage:function(e){},uploadFailed:function(e){this.$q.notify({color:"negative",message:"Unable to upload the file. Let us know if the problem repeats."})},rejected:function(e){this.$q.notify({color:"negative",message:"File rejected. Make sure that the file size do not exceed the limit."})},uploading:function(e){this.fileUploading=!0},uploaded:function(e){this.$q.notify({color:"positive",message:"Image successfuly uploaded!",icon:"check"});let t=JSON.parse(e.xhr.response).filename;this.$router.push({path:"/print",query:{filename:t}})},uploadFinish:function(e){},getImageData:function(){if(void 0==this.cropper){const e=document.createElement("canvas");return e.width=this.$refs.img.width,e.height=this.$refs.img.height,e.getContext("2d").drawImage(this.$refs.img,0,0),e.toDataURL()}return this.cropper.getCroppedCanvas().toDataURL(`image/${this.getTypeFromFilename(this.filename)}`)}}});var w=o(4260),b=o(4379),q=o(3768),k=o(6122),x=o(4607),$=o(1728),F=o(8870),j=o(4554),S=o(7518),U=o.n(S);const C=(0,w.Z)(v,[["render",y]]),I=C;U()(v,"components",{QPage:b.Z,QUploader:q.Z,QCircularProgress:k.Z,QBtn:x.Z,QUploaderAddTrigger:$.Z,QTooltip:F.Z,QIcon:j.Z})}}]);