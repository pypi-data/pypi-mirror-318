"use strict";(self.webpackChunk_amzn_sagemaker_jupyterlab_extension_common=self.webpackChunk_amzn_sagemaker_jupyterlab_extension_common||[]).push([[469],{469:(e,t,a)=>{a.r(t),a.d(t,{ILogger:()=>D,default:()=>ee,logSchemas:()=>m});var o=a(708),r=a(95);const s="@amzn/sagemaker-jupyterlab-extension-common:logger",n="@amzn/sagemaker-jupyterlab-extension-common:jumpstart-deeplinking",i=[200,201],c="/api/ai/config";var d=a(768),l=a(321),u=a.n(l);const p=(e,t,a,s)=>{const n=[],i=()=>{((e,t,a)=>{const s=r.PageConfig.getBaseUrl(),n=`${s}${a}`,i=o.ServerConnection.makeSettings({baseUrl:s}),c={method:"POST",body:JSON.stringify({events:e})},d={retries:t,onFailedAttempt:e=>{console.warn({message:`Deliver events attempt (${e.attemptNumber}) with (${e.retriesLeft}) retries remaining.`,error:e})}};u()((async()=>{let e;try{e=await o.ServerConnection.makeRequest(n,c,i)}catch(e){throw e instanceof TypeError&&Object.setPrototypeOf(e,Error.prototype),e}if(!e.ok)throw new Error(e.statusText)}),d).catch((t=>{console.error({message:`Failed to deliver events after (${d.retries}) retries.`,error:t,events:e})}))})(n.splice(0),e,s)};return setInterval(i,t),(e,t)=>{const o=a-n.length;n.push(...t.slice(0,o)),t.length>o&&(i(),console.log("Logger plugin max buffer size exceeded."))}},m={operationalLogger:{schemaId:"http://sagemaker.studio.jupyterlab.ui.log.schema",schemaVersion:1},performance:{schemaId:"http://sagemaker.studio.jupyterlab.ui.performance.schema",schemaVersion:1}},h=Object.keys(m).map((e=>m[e].schemaId)),g="__INJECT__",{name:v,version:w}=a(147),_=()=>{const e=p(2,5e3,1e4,"aws/sagemaker/api/jumpstart/eventlog");return new d.EventLog({allowedSchemas:h,handlers:[e]})},y="Cookie Preferences";var f;!function(e){e.POST="POST",e.GET="GET",e.PUT="PUT"}(f||(f={}));class b extends Error{constructor(e,t,a,o){super(e),this.errorStatus=t,this.errorCode=a,this.cause=o,Object.setPrototypeOf(this,b.prototype)}}const E=async(e,t,a,s)=>{var n,c;const d=o.ServerConnection.makeSettings({}),l=r.URLExt.join(d.baseUrl,e),u={method:t};a&&(u.body=a),s&&(u.headers=s);const p=await o.ServerConnection.makeRequest(l,u,d);if(!i.includes(p.status)){const e=await p.json(),t=null!==(n=e.errorCode)&&void 0!==n?n:void 0,a=null!==(c=e.errorMessage)&&void 0!==c?c:"unable to fetch data";throw new b(a,p.status,t)}return p};var S=a(29),k=a.n(S),O=a(157);const M={ShortBreadFooter:a(933).css`
  color: var(--jp-ui-font-color1);
  font-family: var(--jp-ui-font-family);
  font-size: var(--jp-ui-font-size1);
  line-height: 24px;
`},I=()=>((0,S.useEffect)((()=>{(()=>{const e=document.createElement("script");e.src="https://prod.assets.shortbread.aws.dev/shortbread.js",e.type="text/javascript",e.async=!0,document.head.appendChild(e),e.onload=()=>window.AWSCShortbreadInstance=(()=>{const e=window.AWSCShortbread({domain:window.location.hostname,hasConsoleNavFooter:!0});return e.checkForCookieConsent(),e})();const t=document.createElement("link");t.href="https://prod.assets.shortbread.aws.dev/shortbread.css",t.rel="stylesheet",document.head.appendChild(t)})()}),[]),k().createElement("div",{className:M.ShortBreadFooter},k().createElement("span",{onClick:()=>{const e=window.AWSCShortbreadInstance;e&&e.customizeCookies()},style:{cursor:"pointer"}},y)));class j extends O.ReactWidget{render(){return k().createElement(I,null)}}var R=a(392);const N={id:"@amzn/sagemaker-jupyterlab-extension-common:panorama",autoStart:!0,requires:[R.IStatusBar],activate:(e,t)=>{(async e=>{try{await e.started;const t=document.getElementById("main"),a=await E("/aws/sagemaker/api/context",f.GET),o=await a.json();if(!t)throw new Error("JupyterLab application or region not found in DOM");((e,t)=>{if(!e)throw new Error("Failed to get region");const a=document.createElement("script"),o=t&&"prod"===t.toLocaleLowerCase()?"Prod":"NonProd";a.src="https://prod.pa.cdn.uis.awsstatic.com/panorama-nav-init.js",a.id="awsc-panorama-bundle",a.type="text/javascript",a.setAttribute("data-config",`{"appEntity": "aws-sagemaker", "region": "${e}", "service" :"sagemaker-jupyterlab", "domain": "${o}"}`),document.head.appendChild(a)})(o.region,o.stage)}catch(e){}})(e);const a=new j;t.registerStatusItem("@amzn/sagemaker-jupyterlab-extension-common:widget:shortbread-status",{item:a,align:"right",rank:599,isActive:()=>!0})}};var T,A=a(930);!function(e){e.TRACE="TRACE",e.DEBUG="DEBUG",e.INFO="INFO",e.WARN="WARN",e.ERROR="ERROR",e.FATAL="FATAL"}(T||(T={}));const D=new A.Token(s);var L,x;!function(e){e.IAM="IAM",e.SSO="IDC",e.SAML="SAML"}(L||(L={})),function(e){e.SMStudio="SageMaker Studio",e.SMStudioSSO="SageMaker Studio SSO",e.MD_IAM="MD_IAM",e.MD_IDC="MD_IDC",e.MD_SAML="MD_SAML"}(x||(x={}));var C=a(13);class z{constructor(e,t,a){this.trace=e=>this.record(e,T.TRACE),this.debug=e=>this.record(e,T.DEBUG),this.info=e=>this.record(e,T.INFO),this.warn=e=>this.record(e,T.WARN),this.error=e=>this.record(e,T.ERROR),this.fatal=e=>this.record(e,T.FATAL),this.child=(e,t,a)=>{const o=t||this.schema,r=a||this.eventLog;return new z(r,o,{...this.context,...e})},this.eventLog=e,this.schema=t,this.context={...a,AccountId:g,SpaceName:g}}format(e,t){if("Error"in e&&void 0!==e.Error){const a={...e,Name:e.Error.name,Message:e.Error.message,Stack:e.Error.stack,Level:t,Context:this.context};return delete e.Error,a}return{...e,Level:t,Context:this.context}}record(e,t){return this.eventLog.recordEvent({version:this.schema.schemaVersion,schema:this.schema.schemaId,body:this.format(e,t)})}}const q={id:s,autoStart:!0,provides:D,activate:e=>{const t={SessionId:(e=>{const t=window.sessionStorage.getItem(e);let a;return null==t?(a={id:(0,C.v4)(),startTime:(new Date).toISOString()},window.sessionStorage.setItem(e,JSON.stringify(a))):a=JSON.parse(t),a})(s).id},a=p(2,5e3,1e4,"aws/sagemaker/api/eventlog"),o=new d.EventLog({allowedSchemas:h,handlers:[a]});return new z(o,m.operationalLogger,t)}};var $,F=a(133);!function(e){e.NOTEBOOK_NOT_AVAILABLE="NOTEBOOK_NOT_AVAILABLE",e.NOTEBOOK_SIZE_TOO_LARGE="NOTEBOOK_SIZE_TOO_LARGE",e.INVALID_REQUEST="INVALID_REQUEST",e.INTERNAL_SERVER_ERROR="INTERNAL_SERVER_ERROR",e.DOWNLOAD_DIRECTORY_NOT_FOUND="DOWNLOAD_DIRECTORY_NOT_FOUND"}($||($={}));const U={errorTitle:"Unable to open notebook",defaultErrorMessage:"Something went wrong when opening the notebook.",notebookNotFoundErrorMessage:"The notebook does not exist or is not supported in the current region.",notebookSizeTooLargeErrorMessage:"The notebook size is too large.",invalidRequestErrorMessage:"A request to open the notebook is invalid.",downLoadDirectoryNotFoundMessage:"Requested download directory for notebook does not exist."};let P=!1;const B=async e=>(0,O.showErrorMessage)(U.errorTitle,{message:e}),V={id:n,requires:[F.IRouter,D],autoStart:!0,activate:async(e,t,a)=>{const{commands:o}=e,s="jumpstart:open-notebook-for-deeplinking",i=((e,t,a)=>{var o;const r={[n]:_()};return e.child({ExtensionName:v,ExtensionVersion:w,PluginId:t},void 0,null!==(o=r[t])&&void 0!==o?o:void 0)})(a,n);o.addCommand(s,{execute:()=>(async(e,t,a)=>{if(!P)try{const{search:o}=e.current;if(!o)return await B(U.invalidRequestErrorMessage),void a.error({Error:new Error("Invalid deep-linking parameters: Query params must be specified")});const{key:s,model_id:n,endpoint_name:i,resource_type:c,inference_component:d,set_default_kernel:l,cluster_id:u}=r.URLExt.queryStringToObject(o);if(!s)return await B(U.invalidRequestErrorMessage),void a.error({Error:new Error("Invalid deep-linking parameters: the notebook key must be specified.")});const p={key:s,...c&&{resource_type:c},...n&&{model_id:n},...i&&{endpoint_name:i},...d&&{inference_component:d},...l&&{set_default_kernel:l},...u&&{cluster_id:u}},m=await(async(e,t)=>{const a=(0,C.v4)();let o;t.info({Message:"Fetching Notebook",ClientRequestId:a});try{o=await E("aws/sagemaker/api/jumpstart/notebook",f.POST,JSON.stringify(e),{"x-client-req-id":a})}catch(e){throw t.error({Error:new Error(`Error executing open notebook: ${e}`),ClientRequestId:a}),e}const r=o.headers.get("x-server-req-id")||"SERVER_REQUEST_ID_MISSING";t.info({Message:"Successfully fetched Notebook",ClientRequestId:a,ServerRequestId:r});const s=await o.json(),{notebookPath:n}=s;return n})(p,a);t.restored.then((()=>{t.commands.execute("docmanager:open",{factory:"Notebook",path:m})})),a.info({Message:"Successfully loaded the Deeplinking plugin"})}catch(e){return e instanceof b?void await(async e=>{switch(e){case $.NOTEBOOK_NOT_AVAILABLE:await B(U.notebookNotFoundErrorMessage);break;case $.NOTEBOOK_SIZE_TOO_LARGE:await B(U.notebookSizeTooLargeErrorMessage);break;case $.INVALID_REQUEST:await B(U.invalidRequestErrorMessage);break;case $.INTERNAL_SERVER_ERROR:await B(U.defaultErrorMessage);break;case $.DOWNLOAD_DIRECTORY_NOT_FOUND:await B(U.downLoadDirectoryNotFoundMessage);break;default:await B(U.defaultErrorMessage)}})($[e.errorCode]):(await B(U.defaultErrorMessage),void a.error({Error:new Error(`Error executing open notebook: ${e}`)}))}finally{P=!0}})(t,e,i)}),t.register({command:s,pattern:new RegExp("[?]command=open-jumpstart-notebook"),rank:10})}};var G=a(612),J=a.n(G);const W="api/contents",Q=".aws",K=Q+"/sso",H=Q+"/amazon_q",Y=Q+"/enabled_features",Z="amazon-q:Q-Developer";class X{constructor(e){this.app=e,this.putDirectory=async(e,t)=>await E(`${W}/${e}`,f.PUT,JSON.stringify({type:"directory",format:"text",name:t})),this.isMessageOriginValid=e=>this.isLocalhost()?"http://localhost:5173"===e.origin:["https://**.v2.*.beta.app.*.aws.dev","https://**.ui.*.aws.dev","https://**.v2.*-gamma.*.on.aws","https://**.datazone.*.on.aws","https://**.sagemaker.*.on.aws","https://**.sagemaker-gamma.*.on.aws"].some((t=>J()(t)(e.origin))),this.putMetadataFile=async(e,t,a,o)=>await E(`${W}/${e?`${e}/${t}.${a}`:`/${t}.${a}`}`,f.PUT,JSON.stringify({content:JSON.stringify(o),format:"text",name:`${t}.${a}`,type:"file"})),this.messageListener=async e=>{if(this.isMessageOriginValid(e))if("MD_TOGGLE_AI_CHAT"!==e.data)try{const t=JSON.parse(e.data);if(!("accessToken"in t))throw new Error("IAM Identity Center access token not found.");this.updateMetadata(t)}catch(e){}else this.toggleAIChat(this.app)}}async initialize(){const e=await this.postAuthDetails();(null==e?void 0:e.environment)===x.SMStudioSSO?e.isQDeveloperEnabled&&this.initializeSMInterval():(null==e?void 0:e.environment)&&this.isMD(e.environment)&&this.initializeTwoWayIframeCommunication()}async initializeSMInterval(){this.smInterval||(this.smInterval=setInterval((async()=>{await this.postAuthDetails()}),3e5))}async updateMetadata(e){var t,a,o,r,s,n;await this.createDirectoryIfDoesNotExist(Q,".aws"),await this.createDirectoryIfDoesNotExist(K,"sso"),await this.createDirectoryIfDoesNotExist(H,"amazon_q"),await this.createDirectoryIfDoesNotExist(Y,"enabled_features"),await this.putMetadataFile(K,"idc_access_token","json",{idc_access_token:e.accessToken}),await this.putMetadataFile(H,"q_dev_profile","json",{q_dev_profile_arn:null!==(t=e.profileArn)&&void 0!==t?t:""}),await this.putMetadataFile(H,"settings","json",{auth_mode:null!==(o=null===(a=e.qSettings)||void 0===a?void 0:a.auth_mode)&&void 0!==o?o:L.IAM,q_enabled:null!==(s=null===(r=e.qSettings)||void 0===r?void 0:r.q_enabled)&&void 0!==s&&s}),await this.putMetadataFile(Y,"enabled_features","json",{enabled_features:null!==(n=e.enabledFeatures)&&void 0!==n?n:[]}),await E("/aws/sagemaker/api/cache",f.POST),await E("/amazon_q_developer_jupyterlab_ext/clear_environment_cache",f.POST),window.postMessage("MD_ENVIRONMENT_LOADED")}async updateInitialLanguageModelConfig(){var e;const t=null===(e=function(e){var t;const a=`; ${document.cookie}`.split("; authMode=");if(2===a.length)return null===(t=a.pop())||void 0===t?void 0:t.split(";").shift()}())||void 0===e?void 0:e.toUpperCase(),a=await this.getLanguageModelConfig();if("IAM"===t)return void((null==a?void 0:a.model_provider_id)||await this.updateLanguageModelConfig(Z));const o=await this.postAuthDetails();(null==o?void 0:o.environment)===x.SMStudioSSO?o.isQDeveloperEnabled?(null==a?void 0:a.model_provider_id)!==Z&&await this.updateLanguageModelConfig(Z):(null==a?void 0:a.model_provider_id)||await this.updateLanguageModelConfig(Z):(null==o?void 0:o.environment)&&this.isMD(o.environment)&&((null==a?void 0:a.model_provider_id)||await this.updateLanguageModelConfig(Z))}async getLanguageModelConfig(){try{const e=await E(c,f.GET);return await e.json()}catch{return}}async updateLanguageModelConfig(e){try{await E(c,f.POST,JSON.stringify({model_provider_id:e}))}catch{return}}async postAuthDetails(){try{const e=await E("/aws/sagemaker/api/auth-details",f.POST);return await e.json()}catch{return}}async getDirectory(e,t){try{return await E(`${W}/${e}?content=${t?1:0}`,f.GET)}catch{return}}sendMessageWhenReadyToReceiveUserMetadata(){var e;null===(e=window.top)||void 0===e||e.postMessage("JL_COMMON_PLUGIN_LOADED","*")}async createDirectoryIfDoesNotExist(e,t){await this.getDirectory(e,!1)||await this.putDirectory(e,t)}isLocalhost(){return["localhost","127.0.0.1"].some((e=>document.location.href.includes(e)))}isMD(e){return[x.MD_IAM,x.MD_IDC,x.MD_SAML].includes(e)}initializeTwoWayIframeCommunication(){window.addEventListener("message",this.messageListener),this.sendMessageWhenReadyToReceiveUserMetadata()}toggleAIChat(e){const t="jupyter-ai::chat";if(e.shell instanceof F.LabShell){const a=Array.from(e.shell.widgets("left")),o=Array.from(e.shell.widgets("right")),r=[...a,...o].find((e=>e.id===t));r&&(r.isHidden?e.shell.activateById(t):o.find((e=>e.id===t))?e.shell.collapseRight():e.shell.collapseLeft())}}}const ee=[N,q,V,{id:"@amzn/sagemaker-jupyterlab-extension-common:q-developer",autoStart:!0,activate:async e=>{const t=new X(e);await t.updateInitialLanguageModelConfig(),e.restored.then((async()=>{t.initialize()}))}}]},147:e=>{e.exports=JSON.parse('{"name":"@amzn/sagemaker-jupyterlab-extension-common","description":"SageMaker JupyterLab workspace common module","version":"0.1.31","author":"Amazon","homepage":"https://aws.amazon.com/sagemaker/","license":"Amazon Software License","licenses":[{"type":"Amazon Software License","url":"http://aws.amazon.com/asl"}],"directories":{"test":"__tests__"},"files":["lib/**/*.{d.ts,eot,gif,html,jpg,js,js.map,json,png,svg,woff2,ttf}","style/**/*.{css,js,eot,gif,html,jpg,json,png,svg,woff2,ttf}","schema/*.json"],"scripts":{"build":"tsc","build:labextension":"tsc && jupyter labextension build .","build:labextension:dev":"jupyter labextension build --development True --source-map True .","lint:check":"eslint . --ext .js,.ts,.tsx","lint:fix":"eslint --fix . --ext .js,.ts,.tsx","release":"run-s build","install:extension":"jlpm run build","watch:src":"tsc -w","watch:labextension":"jupyter labextension watch .","watch":"run-p watch:src watch:labextension","test":"jest","dev:setup":"run-s -n dev:docker:build dev:docker:reset dev:docker:create","dev:docker:build":"(cd devSetup ; sh pull-jupyterlab-base-image.sh && docker build . --tag jupyterlab_ext_dev_image_common --build-arg CONTAINER_USER_ID=$(id -u) --build-arg CONTAINER_GROUP_ID=$(id -g))","dev:docker:reset":"docker stop jupyterlab_ext_dev_container_common || true && docker rm jupyterlab_ext_dev_container_common || true","dev:docker:create":"docker create --name jupyterlab_ext_dev_container_common --publish 8888:8888 --volume $(pwd):/sagemaker-studio-extension --volume $HOME/.aws:/home/sagemaker-user/.aws jupyterlab_ext_dev_image_common","dev:start":"docker start jupyterlab_ext_dev_container_common --attach","test:watch":"jest --watch"},"main":"lib/index.js","dependencies":{"@emotion/css":"^11.1.3","@jupyterlab/application":"^4.0.5","@jupyterlab/apputils":"^4.0.5","@jupyterlab/coreutils":"^6.0.5","@jupyterlab/jupyterlab-telemetry":"^1.0.3","@jupyterlab/services":"^7.0.0","@jupyterlab/statusbar":"^4.0.5","@jupyterlab/ui-components":"^4.0.5","@lumino/coreutils":"^2.1.2","@lumino/signaling":"^2.1.2","@lumino/widgets":"^2.1.2","@testing-library/jest-dom":"^6.1.6","isomorphic-fetch":"^3.0.0","p-retry":"^6.1.0","react":"^18.2.0","uuid":"^9.0.1","wildcard-match":"^5.1.3"},"jupyterlab":{"extension":true,"outputDir":"sagemaker_jupyterlab_extension_common/labextension"},"devDependencies":{"@babel/preset-env":"^7.22.7","@babel/preset-react":"^7.22.5","@jupyterlab/builder":"^4.0.5","@testing-library/react":"^13.0.0","@types/jest":"^29.5.12","@types/lodash":"^4.14.172","@types/uuid":"^9.0.6","@typescript-eslint/eslint-plugin":"^5.61.0","eslint-config-prettier":"^8.8.0","eslint-plugin-import":"^2.27.5","eslint-plugin-json":"^3.1.0","eslint-plugin-prettier":"^4.2.1","eslint-plugin-react":"^7.32.2","eslint-plugin-react-hooks":"^4.6.0","jest":"^28.0.0","jest-environment-jsdom":"^29.7.0","npm-run-all":"^4.1.5","prettier":"^2.4.1","ts-jest":"^28.0.5","typescript":"^4.3.5"}}')}}]);