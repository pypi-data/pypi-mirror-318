{% extends "base.html" %}

{% block title %}ðŸš€ Node Dashboard{% endblock %}

{% block content %}
<div class="container mx-auto p-6">
    <h1 class="text-5xl font-bold mb-6 text-center text-yellow-400">
        ðŸš€ Meme Node Control Dashboard ðŸš€
    </h1>
    <p class="text-center text-gray-600 mb-8">
        Manage your node while embracing the power of <span class="font-bold text-green-500">meme energy</span>! ðŸ˜Ž
    </p>

    <div class="flex justify-center gap-4">
        <button
            id="startNodeBtn"
            class="bg-gradient-to-r from-green-400 to-blue-500 text-white font-bold py-3 px-6 rounded-full hover:shadow-lg"
        >
            ðŸŒŸ Start Node
        </button>
        <button
            id="stopNodeBtn"
            class="bg-gradient-to-r from-red-400 to-pink-500 text-white font-bold py-3 px-6 rounded-full hover:shadow-lg"
        >
            ðŸ›‘ Stop Node
        </button>
    </div>

    <div id="responseMessage" class="mt-6 text-center font-medium"></div>

    <div id="logViewer" class="mt-8 bg-gray-900 p-4 rounded shadow-md h-96 overflow-auto hidden">
        <h2 class="text-2xl font-bold mb-4 text-green-300">ðŸ“œ Node Logs</h2>
        <pre id="logContent" class="bg-gray-800 p-4 text-green-400 rounded shadow-md text-sm"></pre>
    </div>

    <div class="mt-8 text-center">
        <img src="{{ url_for('static', filename='assets/node-control-meme.gif') }}" alt="Node Control Meme" class="mx-auto w-64 h-64">
        <p class="text-gray-500 mt-4">"Node control? Easy peasy, meme squeezy!"</p>
    </div>
</div>

<script>
    const logViewer = document.getElementById("logViewer");
    const logContent = document.getElementById("logContent");

    async function controlNode(action) {
        const responseMessage = document.getElementById("responseMessage");

        if (action === "start-node") {
            // Start streaming logs for "start-node"
            logViewer.classList.remove("hidden");
            logContent.textContent = "ðŸš€ Starting node...\n";

            const eventSource = new EventSource("/start-node-logs");

            eventSource.onmessage = (event) => {
                logContent.textContent += "ðŸ“œ " + event.data + "\n";
                logContent.scrollTop = logContent.scrollHeight; // Scroll to the latest log
            };

            eventSource.onerror = () => {
                logContent.textContent += "\nðŸŽ‰ Log stream ended.";
                eventSource.close();
            };

        } else {
            // Handle "stop-node"
            const response = await fetch(`/${action}`, { method: "POST" });
            const data = await response.json();
            responseMessage.textContent = data.message || data.error;
            responseMessage.className = response.ok ? "text-green-400 mt-6" : "text-red-400 mt-6";

            if (action === "stop-node") {
                logViewer.classList.add("hidden"); // Hide logs on stop
                logContent.textContent = ""; // Clear logs
            }
        }
    }

    document.getElementById("startNodeBtn").addEventListener("click", () => controlNode("start-node"));
    document.getElementById("stopNodeBtn").addEventListener("click", () => controlNode("stop-node"));
</script>
{% endblock %}
