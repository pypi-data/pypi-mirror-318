export const ids=["12913"];export const modules={50875:function(e,t,s){s.d(t,{Eu:function(){return o},hZ:function(){return n}});var a=s(11259);const i=["#4269d0","#f4bd4a","#ff725c","#6cc5b0","#a463f2","#ff8ab7","#9c6b4e","#97bbf5","#01ab63","#9498a0","#094bad","#c99000","#d84f3e","#49a28f","#048732","#d96895","#8043ce","#7599d1","#7a4c31","#74787f","#6989f4","#ffd444","#ff957c","#8fe9d3","#62cc71","#ffadda","#c884ff","#badeff","#bf8b6d","#b6bac2","#927acc","#97ee3f","#bf3947","#9f5b00","#f48758","#8caed6","#f2b94f","#eff26e","#e43872","#d9b100","#9d7a00","#698cff","#d9d9d9","#00d27e","#d06800","#009f82","#c49200","#cbe8ff","#fecddf","#c27eb6","#8cd2ce","#c4b8d9","#f883b0","#a49100","#f48800","#27d0df","#a04a9b"];function o(e){return i[e%i.length]}function n(e,t){const s=t.getPropertyValue(`--graph-color-${e+1}`)||o(e);return(0,a.Rq)(s)}},44968:function(e,t,s){var a=s(44249),i=s(72621),o=(s(92745),s(92519),s(42179),s(89256),s(24931),s(88463),s(57449),s(19814),s(39527),s(99790),s(67670),s(34810),s(41360),s(13334),s(34595),s(15093)),n=s(57243),r=s(18672),l=s(27486);const d=15,c=12;(0,a.Z)([(0,o.Mo)("sankey-chart")],(function(e,t){class s extends t{constructor(...t){super(...t),e(this)}}return{F:s,d:[{kind:"field",decorators:[(0,o.Cb)({attribute:!1})],key:"hass",value:void 0},{kind:"field",decorators:[(0,o.Cb)({attribute:!1})],key:"data",value:()=>({nodes:[],links:[]})},{kind:"field",decorators:[(0,o.Cb)({type:Boolean})],key:"vertical",value:()=>!1},{kind:"field",decorators:[(0,o.Cb)({attribute:!1})],key:"loadingText",value:void 0},{kind:"field",key:"_statePerPixel",value:()=>0},{kind:"field",key:"_textMeasureCanvas",value:void 0},{kind:"field",key:"_sizeController",value(){return new r.Z(this,{callback:e=>e[0]?.contentRect})}},{kind:"method",key:"disconnectedCallback",value:function(){(0,i.Z)(s,"disconnectedCallback",this,3)([]),this._textMeasureCanvas=void 0}},{kind:"method",key:"willUpdate",value:function(){this._statePerPixel=0}},{kind:"method",key:"render",value:function(){if(!this._sizeController.value)return this.loadingText??n.Ld;const{width:e,height:t}=this._sizeController.value,{nodes:s,paths:a}=this._processNodesAndPaths(this.data.nodes,this.data.links);return n.dy` <svg width="${e}" height="${t}" viewBox="0 0 ${e} ${t}" preserveAspectRatio="none"> <defs> ${a.map(((e,t)=>n.YP` <linearGradient id="gradient${e.sourceNode.id}.${e.targetNode.id}.${t}" gradientTransform="${this.vertical?"rotate(90)":""}"> <stop offset="0%" stop-color="${e.sourceNode.color}"></stop> <stop offset="100%" stop-color="${e.targetNode.color}"></stop> </linearGradient> `))} </defs> ${a.map(((e,t)=>n.YP` <path d="${e.path.map((([e,t,s])=>`${e}${t},${s}`)).join(" ")} Z" fill="url(#gradient${e.sourceNode.id}.${e.targetNode.id}.${t})" fill-opacity="0.4"/> `))} ${s.map((e=>e.passThrough?n.Ld:n.YP` <g transform="translate(${e.x},${e.y})"> <rect class="node" width="${this.vertical?e.size:d}" height="${this.vertical?d:e.size}" style="fill:${e.color}"> <title>${e.tooltip}</title> </rect> ${this.vertical?n.Ld:n.YP` <text class="node-label" x="${20}" y="${e.size/2}" text-anchor="start" dominant-baseline="middle">${e.label}</text> `} </g> `))} </svg> ${this.vertical?s.map((e=>{if(!e.label)return n.Ld;const t=6+e.size,s=this._getVerticalLabelFontSize(e.label,t);return n.dy`<div class="node-label vertical" style="left:${e.x-3}px;top:${e.y+d}px;width:${t}px;height:${36}px;font-size:${s}px;line-height:${s}px" title="${e.label}"> ${e.label} </div>`})):n.Ld} `}},{kind:"field",key:"_processNodesAndPaths",value(){return(0,l.Z)(((e,t)=>{const s=e.filter((e=>e.value>0)),a=[...new Set(s.map((e=>e.index)))].sort(),{links:i,passThroughNodes:o}=this._processLinks(s,a,t),n=this._processNodes([...s,...o],a);return{nodes:n,paths:this._processPaths(n,i)}}))}},{kind:"method",key:"_processLinks",value:function(e,t,s){const a=new Map,i=new Map,o=[],n=[];return s.forEach((s=>{const r=e.find((e=>e.id===s.source)),l=e.find((e=>e.id===s.target));if(!r||!l)return;const d=i.get(r.id)||0,c=a.get(l.id)||0,u=r.value-d,h=l.value-c,f=Math.min(s.value??u,u,h);a.set(l.id,c+f),i.set(r.id,d+f);const v=t.findIndex((e=>e===r.index)),p=t.findIndex((e=>e===l.index)),g=t.slice(v+1,p).map((e=>{const t={passThrough:!0,id:`${r.id}-${l.id}-${e}`,value:f,index:e};return n.push(t),t.id}));f>0&&o.push({...s,value:f,offset:{source:d/(r.value||1),target:c/(l.value||1)},passThroughNodeIds:g})})),{links:o,passThroughNodes:n}}},{kind:"method",key:"_processNodes",value:function(e,t){const s=this.vertical?this._sizeController.value.width-12:this._sizeController.value.height-12,a={};e.forEach((e=>{a[e.index]?a[e.index].push(e):a[e.index]=[e]}));const i=this._getSectionFlexSize(Object.values(a)),o=t.map(((e,t)=>{const o=a[e].map((e=>({...e,color:e.color||"var(--primary-color)",x:0,y:0,size:0}))),n=s-(6*o.length-6),r=o.reduce(((e,t)=>e+t.value),0),{nodes:l,statePerPixel:d}=this._setNodeSizes(o,n,r);return{nodes:l,offset:i*t,index:e,totalValue:r,statePerPixel:d}}));return o.forEach((e=>{let t=0;e.statePerPixel!==this._statePerPixel?e.nodes.forEach((e=>{const s=Math.max(3,Math.floor(e.value/this._statePerPixel));t+=s,e.size=s})):t=e.nodes.reduce(((e,t)=>e+t.size),0);const a=s-t,i=a/(e.nodes.length-1);let o=e.nodes.length>1?6:a/2+6;e.nodes.forEach((t=>{this.vertical?(t.x=o,t.y=e.offset):(t.x=e.offset,t.y=o),o+=t.size+i}))})),o.flatMap((e=>e.nodes))}},{kind:"method",key:"_processPaths",value:function(e,t){const s=this.vertical?"y":"x",a=this.vertical?"x":"y",i=new Map(e.map((e=>[e.id,e])));return t.map((e=>{const{source:t,target:o,value:n,offset:r,passThroughNodeIds:l}=e,c=[t,...l,o].map((e=>i.get(e))),u=[r.source,...e.passThroughNodeIds.map((()=>0)),r.target],h=c[0],f=c[c.length-1];let v=[["M",h[s]+d,h[a]+r.source*h.size]];for(let e=0;e<c.length-1;e++){const t=c[e],i=c[e+1],o=(i[s]-t[s])/2+t[s],n=t[a]+u[e]*t.size,r=i[a]+u[e+1]*i.size;v.push(["L",t[s]+d,n],["C",o,n],["",o,r],["",i[s],r])}for(let e=c.length-1;e>0;e--){const t=c[e],i=c[e-1],o=(t[s]-i[s])/2+i[s],r=t[a]+u[e]*t.size+Math.max(n/(t.value||1)*t.size,0),l=i[a]+u[e-1]*i.size+Math.max(n/(i.value||1)*i.size,0);v.push(["L",t[s],r],["C",o,r],["",o,l],["",i[s]+d,l])}return this.vertical&&(v=v.map((e=>[e[0],e[2],e[1]]))),{sourceNode:h,targetNode:f,value:n,path:v}}))}},{kind:"method",key:"_setNodeSizes",value:function(e,t,s){const a=s/t;a>this._statePerPixel&&(this._statePerPixel=a);let i=0;const o=e.map((e=>{if(3===e.size)return e;let t=Math.floor(e.value/this._statePerPixel);return t<3&&(i+=3-t,t=3),{...e,size:t}}));return i>0?this._setNodeSizes(o,t-i,s):{nodes:o,statePerPixel:this._statePerPixel}}},{kind:"method",key:"_getSectionFlexSize",value:function(e){const t=this.vertical?this._sizeController.value.height:this._sizeController.value.width;if(e.length<2)return t;let s;if(this.vertical)s=39;else{const t=e[e.length-1],a=5;s=t.length>0?Math.max(...t.map((e=>d+a+(e.label?this._getTextWidth(e.label):0)))):0}const a=(t-s)/(e.length-1);return s<a?a:t/e.length}},{kind:"method",key:"_getTextWidth",value:function(e){this._textMeasureCanvas||(this._textMeasureCanvas=document.createElement("canvas"));const t=this._textMeasureCanvas.getContext("2d");return t?(t.font="12px sans-serif",t.measureText(e).width):0}},{kind:"method",key:"_getVerticalLabelFontSize",value:function(e,t){const s=e.split(" ").reduce(((e,t)=>e.length>t.length?e:t),""),a=this._getTextWidth(s);return Math.min(c,t/a*c)}},{kind:"field",static:!0,key:"styles",value:()=>n.iv`:host{display:block;flex:1;background:var(--ha-card-background,var(--card-background-color,#000));overflow:hidden;position:relative}svg{overflow:visible;position:absolute}.node-label{font-size:${c}px;fill:var(--primary-text-color,white)}.node-label.vertical{position:absolute;text-align:center;overflow:hidden}`}]}}),n.oi)},6736:function(e,t,s){s.d(t,{f:function(){return n}});var a=s(44249),i=s(72621),o=(s(39527),s(36993),s(15093));const n=e=>(0,a.Z)(null,(function(e,t){class s extends t{constructor(...t){super(...t),e(this)}}return{F:s,d:[{kind:"field",decorators:[(0,o.Cb)({attribute:!1})],key:"hass",value:void 0},{kind:"field",key:"hassSubscribeRequiredHostProps",value:void 0},{kind:"field",key:"__unsubs",value:void 0},{kind:"method",key:"connectedCallback",value:function(){(0,i.Z)(s,"connectedCallback",this,3)([]),this._checkSubscribed()}},{kind:"method",key:"disconnectedCallback",value:function(){if((0,i.Z)(s,"disconnectedCallback",this,3)([]),this.__unsubs){for(;this.__unsubs.length;){const e=this.__unsubs.pop();e instanceof Promise?e.then((e=>e())):e()}this.__unsubs=void 0}}},{kind:"method",key:"updated",value:function(e){if((0,i.Z)(s,"updated",this,3)([e]),e.has("hass"))this._checkSubscribed();else if(this.hassSubscribeRequiredHostProps)for(const t of e.keys())if(this.hassSubscribeRequiredHostProps.includes(t))return void this._checkSubscribed()}},{kind:"method",key:"hassSubscribe",value:function(){return[]}},{kind:"method",key:"_checkSubscribed",value:function(){void 0===this.__unsubs&&this.isConnected&&void 0!==this.hass&&!this.hassSubscribeRequiredHostProps?.some((e=>void 0===this[e]))&&(this.__unsubs=this.hassSubscribe())}}]}}),e)},10782:function(e,t,s){s.a(e,(async function(e,a){try{s.r(t);var i=s(44249),o=(s(92745),s(84283),s(39527),s(41360),s(13334),s(34595),s(57243)),n=s(15093),r=(s(54977),s(37583),s(1118)),l=s(17705),d=s(6736),c=(s(44968),s(50875)),u=s(50602),h=e([r,u]);[r,u]=h.then?(await h)():h;(0,i.Z)([(0,n.Mo)("hui-energy-sankey-card")],(function(e,t){return{F:class extends t{constructor(...t){super(...t),e(this)}},d:[{kind:"field",decorators:[(0,n.Cb)({attribute:!1})],key:"hass",value:void 0},{kind:"field",decorators:[(0,n.SB)()],key:"_config",value:void 0},{kind:"field",decorators:[(0,n.SB)()],key:"_data",value:void 0},{kind:"field",key:"hassSubscribeRequiredHostProps",value:()=>["_config"]},{kind:"method",key:"setConfig",value:function(e){this._config=e}},{kind:"method",key:"hassSubscribe",value:function(){return[(0,r.UB)(this.hass,{key:this._config?.collection_key}).subscribe((e=>{this._data=e}))]}},{kind:"method",key:"getCardSize",value:function(){return 5}},{kind:"method",key:"getGridOptions",value:function(){return{columns:12,min_columns:6,rows:6,min_rows:2}}},{kind:"method",key:"shouldUpdate",value:function(e){return e.has("_config")||e.has("_data")}},{kind:"method",key:"render",value:function(){if(!this._config)return o.Ld;if(!this._data)return o.dy`${this.hass.localize("ui.panel.lovelace.cards.energy.loading")}`;const e=this._data.prefs,t=(0,r.Jj)(e),s=[],a=[],i={id:"home",label:this.hass.localize("ui.panel.lovelace.cards.energy.energy_distribution.home"),value:0,color:"var(--primary-color)",index:1};if(s.push(i),t.grid){const e=(0,l.q6)(this._data.stats,t.grid[0].flow_from.map((e=>e.stat_energy_from)))??0;s.push({id:"grid",label:this.hass.localize("ui.panel.lovelace.cards.energy.energy_distribution.grid"),value:e,tooltip:`${(0,u.uf)(e,this.hass.locale)} kWh`,color:"var(--energy-grid-consumption-color)",index:0}),a.push({source:"grid",target:"home"})}if(t.battery){const e=(0,l.q6)(this._data.stats,t.battery.map((e=>e.stat_energy_from)))||0;s.push({id:"battery",label:this.hass.localize("ui.panel.lovelace.cards.energy.energy_distribution.battery"),value:e,tooltip:`${(0,u.uf)(e,this.hass.locale)} kWh`,color:"var(--energy-battery-out-color)",index:0}),a.push({source:"battery",target:"home"})}if(t.solar){const e=(0,l.q6)(this._data.stats,t.solar.map((e=>e.stat_energy_from)))||0;s.push({id:"solar",label:this.hass.localize("ui.panel.lovelace.cards.energy.energy_distribution.solar"),value:e,tooltip:`${(0,u.uf)(e,this.hass.locale)} kWh`,color:"var(--energy-solar-color)",index:0}),a.push({source:"solar",target:"home"})}if(i.value=s.filter((e=>0===e.index)).reduce(((e,t)=>e+(t.value||0)),0),t.battery){const e=(0,l.q6)(this._data.stats,t.battery.map((e=>e.stat_energy_to)))||0;s.push({id:"battery_in",label:this.hass.localize("ui.panel.lovelace.cards.energy.energy_distribution.battery"),value:e,tooltip:`${(0,u.uf)(e,this.hass.locale)} kWh`,color:"var(--energy-battery-in-color)",index:1}),s.forEach((e=>{0===e.index&&a.push({source:e.id,target:"battery_in"})})),i.value-=e}if(t.grid&&t.grid[0].flow_to){const e=(0,l.q6)(this._data.stats,t.grid[0].flow_to.map((e=>e.stat_energy_to)))??0;s.push({id:"grid_return",label:this.hass.localize("ui.panel.lovelace.cards.energy.energy_distribution.grid"),value:e,tooltip:`${(0,u.uf)(e,this.hass.locale)} kWh`,color:"var(--energy-grid-return-color)",index:1}),s.forEach((e=>{0===e.index&&"grid"!==e.id&&a.push({source:e.id,target:"grid_return"})})),i.value-=e}const n={no_area:{value:0,devices:[]}},d={no_floor:{value:0,areas:["no_area"]}};let h=i.value;const f=getComputedStyle(this);e.device_consumption.forEach(((e,t)=>{const s=this.hass.entities[e.stat_consumption],a=e.stat_consumption in this._data.stats&&(0,l.Kj)(this._data.stats[e.stat_consumption])||0;if(a<=0)return;h-=a;const i={id:e.stat_consumption,label:e.name||(0,l.Kd)(this.hass,e.stat_consumption,this._data.statsMetadata[e.stat_consumption]),value:a,tooltip:`${(0,u.uf)(a,this.hass.locale)} kWh`,color:(0,c.hZ)(t,f),index:4},o=s?.area_id??(s.device_id&&this.hass.devices[s.device_id]?.area_id);if(o&&o in this.hass.areas){const e=this.hass.areas[o];e.area_id in n?(n[e.area_id].value+=i.value,n[e.area_id].devices.push(i)):n[e.area_id]={value:i.value,devices:[i]},e.floor_id&&e.floor_id in this.hass.floors?e.floor_id in d?(d[e.floor_id].value+=i.value,d[e.floor_id].areas.includes(e.area_id)||d[e.floor_id].areas.push(e.area_id)):d[e.floor_id]={value:i.value,areas:[e.area_id]}:(d.no_floor.value+=i.value,d.no_floor.areas.includes(e.area_id)||d.no_floor.areas.unshift(e.area_id))}else n.no_area.value+=i.value,n.no_area.devices.push(i)})),Object.keys(d).sort(((e,t)=>(this.hass.floors[t]?.level??-1/0)-(this.hass.floors[e]?.level??-1/0))).forEach((e=>{let t=`floor_${e}`;"no_floor"===e?t="home":(s.push({id:t,label:this.hass.floors[e].name,value:d[e].value,tooltip:`${(0,u.uf)(d[e].value,this.hass.locale)} kWh`,index:2}),a.push({source:"home",target:t})),d[e].areas.forEach((e=>{let i=`area_${e}`;"no_area"===e?i="home":(s.push({id:i,label:this.hass.areas[e].name,value:n[e].value,tooltip:`${(0,u.uf)(n[e].value,this.hass.locale)} kWh`,index:3}),a.push({source:t,target:i,value:n[e].value})),n[e].devices.forEach((e=>{s.push(e),a.push({source:i,target:e.id,value:e.value})}))}))})),h>0?(s.push({id:"untracked",label:this.hass.localize("ui.panel.lovelace.cards.energy.energy_devices_detail_graph.untracked_consumption"),value:h,tooltip:`${(0,u.uf)(h,this.hass.locale)} kWh`,color:"var(--state-unavailable-color)",index:4}),a.push({source:"home",target:"untracked",value:h})):h<0&&(i.value-=h),i.tooltip=`${(0,u.uf)(i.value,this.hass.locale)} kWh`;const v=s.some((e=>e.value>0));return o.dy` <ha-card .header="${this._config.title}"> <div class="card-content"> ${v?o.dy`<sankey-chart .data="${{nodes:s,links:a}}" .vertical="${"vertical"===this._config.layout}" .loadingText="${this.hass.localize("ui.panel.lovelace.cards.energy.loading")}"></sankey-chart>`:o.dy`${this.hass.localize("ui.panel.lovelace.cards.energy.no_data_period")}`} </div> </ha-card> `}},{kind:"field",static:!0,key:"styles",value:()=>o.iv`:host{display:block;height:calc(var(--row-size,8) * (var(--row-height,50px) + var(--row-gap,0px)) - var(--row-gap,0px))}ha-card{height:100%;display:flex;flex-direction:column}.card-content{flex:1;display:flex}`}]}}),(0,d.f)(o.oi));a()}catch(e){a(e)}}))},32424:function(e,t,s){s.d(t,{E:function(){return o}});var a=s(53907),i=s(18112);function o(e,t,s){const o=(0,i.Q)(e,s?.in);return isNaN(t)?(0,a.L)(s?.in||e,NaN):t?(o.setDate(o.getDate()+t),o):o}},38836:function(e,t,s){s.d(t,{T:function(){return o}});var a=s(23711),i=s(76808);function o(e,t,s){return(0,a.n)(e,t*i.vh,s)}},23711:function(e,t,s){s.d(t,{n:function(){return o}});var a=s(53907),i=s(18112);function o(e,t,s){return(0,a.L)(s?.in||e,+(0,i.Q)(e)+t)}},23459:function(e,t,s){s.d(t,{z:function(){return o}});var a=s(53907),i=s(18112);function o(e,t,s){const o=(0,i.Q)(e,s?.in);if(isNaN(t))return(0,a.L)(s?.in||e,NaN);if(!t)return o;const n=o.getDate(),r=(0,a.L)(s?.in||e,o.getTime());r.setMonth(o.getMonth()+t+1,0);return n>=r.getDate()?r:(o.setFullYear(r.getFullYear(),r.getMonth(),n),o)}},2425:function(e,t,s){s.d(t,{U:function(){return i}});var a=s(18112);function i(e,t){const s=+(0,a.Q)(e)-+(0,a.Q)(t);return s<0?-1:s>0?1:s}},14276:function(e,t,s){s.d(t,{_:function(){return i}});var a=s(18112);function i(e,t){return+(0,a.Q)(e)-+(0,a.Q)(t)}},6542:function(e,t,s){s.d(t,{d:()=>r});var a=s("18492"),i=s("2425");function o(e,t,s){const[i,o]=(0,a.d)(s?.in,e,t);return 12*(i.getFullYear()-o.getFullYear())+(i.getMonth()-o.getMonth())}var n=s("3938");function r(e,t,s){const[r,l,d]=(0,a.d)(s?.in,e,e,t),c=(0,i.U)(l,d),u=Math.abs(o(l,d));if(u<1)return 0;1===l.getMonth()&&l.getDate()>27&&l.setDate(30),l.setMonth(l.getMonth()-c*u);let h=(0,i.U)(l,d)===-c;(0,n.h)(r)&&1===u&&1===(0,i.U)(r,d)&&(h=!1);const f=c*(u-+h);return 0===f?0:f}},96500:function(e,t,s){s.d(t,{i:function(){return i}});var a=s(18112);function i(e,t){const s=(0,a.Q)(e,t?.in);return s.setHours(23,59,59,999),s}},2621:function(e,t,s){s.d(t,{V:function(){return i}});var a=s(18112);function i(e,t){const s=(0,a.Q)(e,t?.in),i=s.getMonth();return s.setFullYear(s.getFullYear(),i+1,0),s.setHours(23,59,59,999),s}},86319:function(e,t,s){s.d(t,{b:function(){return i}});var a=s(18112);function i(e,t){return 1===(0,a.Q)(e,t?.in).getDate()}},3938:function(e,t,s){s.d(t,{h:function(){return n}});var a=s(96500),i=s(2621),o=s(18112);function n(e,t){const s=(0,o.Q)(e,t?.in);return+(0,a.i)(s,t)==+(0,i.V)(s,t)}}};
//# sourceMappingURL=12913.6b06b980b036cac6.js.map